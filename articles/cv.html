<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cv">
<title>Cross-validation of regression models • cv</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cross-validation of regression models">
<meta property="og:description" content="cv">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cv</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/cv.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/cv-extend.html">Extending the cv package</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Cross-validation of regression models</h1>
                        <h4 data-toc-skip class="author">John Fox and
Georges Monette</h4>
            
            <h4 data-toc-skip class="date">2023-10-21</h4>
      
      
      <div class="d-none name"><code>cv.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="cross-validation">Cross-validation<a class="anchor" aria-label="anchor" href="#cross-validation"></a>
</h2>
<p>Cross-validation (CV) is an essentially simple and intuitively
reasonable approach to estimating the predictive accuracy of regression
models. CV is developed in many standard sources on regression modeling
and “machine learning”—we particularly recommend <span class="citation">James, Witten, Hastie, &amp; Tibshirani (2021, secs.
5.1, 5.3)</span>—and so we will describe the method only briefly here
before taking up computational issues and some examples.</p>
<p>Validating research by replication on independently collected data is
a common scientific norm. Emulating this process in a single study by
data-division is less common: The data are randomly divided into two,
possibly equal-size, parts; the first part is used to develop and fit a
statistical model; and then the second part is used to assess the
adequacy of the model fit to the first part of the data. Data-division,
however, suffers from two problems: (1) Dividing the data decreases the
sample size and thus increases sampling error; and (2), even more
disconcertingly, particularly in smaller samples, the results can vary
substantially based on the random division of the data: See <span class="citation">Harrell (2015, sec. 5.3)</span> for this and other
remarks about data-division and cross-validation.</p>
<p>Cross-validation speaks to both of these issues. In CV, the data are
randomly divided as equally as possible into several, say <span class="math inline">\(k\)</span>, parts, called “folds.” The statistical
model is fit <span class="math inline">\(k\)</span> times, leaving each
fold out in turn. Each fitted model is then used to predict the response
variable for the omitted fold, computing some CV criterion or “cost”
measure, such as the mean-squared error of prediction. The CV criterion
is then averaged over the <span class="math inline">\(k\)</span> folds.
In the extreme <span class="math inline">\(k = n\)</span>, the number of
cases in the data, thus omitting individual cases and refitting the
model <span class="math inline">\(n\)</span> times—a procedure termed
“leave-one-out (LOO) cross-validation.”</p>
<p>Because the <span class="math inline">\(k\)</span> models are each
fit to <span class="math inline">\(n - 1\)</span> cases, LOO CV produces
a nearly unbiased estimate of prediction error. The <span class="math inline">\(n\)</span> regression models are highly
statistical dependent, however, based as they are on nearly the same
data, and so the resulting estimate of prediction error has relatively
large variance. In contrast, estimated prediction error for <span class="math inline">\(k\)</span>-fold CV with <span class="math inline">\(k = 5\)</span> or <span class="math inline">\(10\)</span> (commonly employed choices) are
somewhat biased but have smaller variance. It is also possible to
correct <span class="math inline">\(k\)</span>-fold CV for bias (see
below).</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="polynomial-regression-for-the-auto-data">Polynomial regression for the <code>Auto</code> data<a class="anchor" aria-label="anchor" href="#polynomial-regression-for-the-auto-data"></a>
</h3>
<p>The data for this example are drawn from the <strong>ISLR2</strong>
package for R, associated with <span class="citation">James et al.
(2021)</span>, and the presentation here is close (though not identical)
to that in the original source <span class="citation">(James et al.,
2021, secs. 5.1, 5.3)</span>, and it demonstrates the use of the
<code><a href="../reference/cv.html">cv()</a></code> function in the <strong>cv</strong> package.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;span class="citation"&gt;James et al. (2021)&lt;/span&gt; use
the &lt;code&gt;&lt;a href="../reference/cv.html"&gt;cv.glm()&lt;/a&gt;&lt;/code&gt; function in the &lt;strong&gt;boot&lt;/strong&gt; package
&lt;span class="citation"&gt;(Canty &amp;amp; Ripley, 2022; Davison &amp;amp; Hinkley,
1997)&lt;/span&gt;. Despite its name, &lt;code&gt;&lt;a href="../reference/cv.html"&gt;cv.glm()&lt;/a&gt;&lt;/code&gt; is an independent
function and not a method of a &lt;code&gt;&lt;a href="../reference/cv.html"&gt;cv()&lt;/a&gt;&lt;/code&gt; generic function.&lt;/p&gt;'><sup>1</sup></a></p>
<p>The <code>Auto</code> dataset contains information about 392
cars:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Auto"</span>, package<span class="op">=</span><span class="st">"ISLR2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span></span>
<span><span class="co">#&gt;   mpg cylinders displacement horsepower weight acceleration year origin</span></span>
<span><span class="co">#&gt; 1  18         8          307        130   3504         12.0   70      1</span></span>
<span><span class="co">#&gt; 2  15         8          350        165   3693         11.5   70      1</span></span>
<span><span class="co">#&gt; 3  18         8          318        150   3436         11.0   70      1</span></span>
<span><span class="co">#&gt; 4  16         8          304        150   3433         12.0   70      1</span></span>
<span><span class="co">#&gt; 5  17         8          302        140   3449         10.5   70      1</span></span>
<span><span class="co">#&gt; 6  15         8          429        198   4341         10.0   70      1</span></span>
<span><span class="co">#&gt;                        name</span></span>
<span><span class="co">#&gt; 1 chevrolet chevelle malibu</span></span>
<span><span class="co">#&gt; 2         buick skylark 320</span></span>
<span><span class="co">#&gt; 3        plymouth satellite</span></span>
<span><span class="co">#&gt; 4             amc rebel sst</span></span>
<span><span class="co">#&gt; 5               ford torino</span></span>
<span><span class="co">#&gt; 6          ford galaxie 500</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 392   9</span></span></code></pre></div>
<p>With the exception of <code>origin</code> (which we don’t use here),
these variables are largely self-explanatory, except possibly for units
of measurement: for details see
<code><a href="https://rdrr.io/pkg/ISLR2/man/Auto.html" class="external-link">help("Auto", package="ISLR2")</a></code>.</p>
<p>We’ll focus here on the relationship of <code>mpg</code> (miles per
gallon) to <code>horsepower</code>, as displayed in the following
scatterplot:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">horsepower</span>, data<span class="op">=</span><span class="va">Auto</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/mpg-horsepower-scatterplot-1.png" alt="`mpg` vs `horsepower` for the `Auto` data" width="100%"><p class="caption">
<code>mpg</code> vs <code>horsepower</code> for the <code>Auto</code>
data
</p>
</div>
<p>The relationship between the two variables is monotone, decreasing,
and nonlinear. Following <span class="citation">James et al.
(2021)</span>, we’ll consider approximating the relationship by a
polynomial regression, with the degree of the polynomial <span class="math inline">\(p\)</span> ranging from 1 (a linear regression) to
10.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Although it serves to illustrate the use of CV, a
polynomial is probably not the best choice here. Consider, for example
the scatterplot for log-transformed &lt;code&gt;mpg&lt;/code&gt; and
&lt;code&gt;horsepower&lt;/code&gt;, produced by
&lt;code&gt;plot(mpg ~ horsepower, data=Auto, log="xy")&lt;/code&gt; (execution of
which is left to the reader).&lt;/p&gt;'><sup>2</sup></a>
Polynomial fits for <span class="math inline">\(p = 1\)</span> to <span class="math inline">\(5\)</span> are shown in the following figure:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">horsepower</span>, data<span class="op">=</span><span class="va">Auto</span><span class="op">)</span></span>
<span><span class="va">horsepower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Auto</span>, </span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">horsepower</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">horsepower</span><span class="op">)</span>, </span>
<span>                       length<span class="op">=</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">horsepower</span>,<span class="va">p</span><span class="op">)</span>, data<span class="op">=</span><span class="va">Auto</span><span class="op">)</span></span>
<span>  <span class="va">mpg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, newdata<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>horsepower<span class="op">=</span><span class="va">horsepower</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">horsepower</span>, <span class="va">mpg</span>, col<span class="op">=</span><span class="va">p</span> <span class="op">+</span> <span class="fl">1</span>, lty<span class="op">=</span><span class="va">p</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">6</span>, lty<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, lwd<span class="op">=</span><span class="fl">2</span>,</span>
<span>       title<span class="op">=</span><span class="st">"Degree"</span>, inset<span class="op">=</span><span class="fl">0.02</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/mpg-horsepower-scatterplot-polynomials-1.png" alt="`mpg` vs `horsepower` for the `Auto` data" width="100%"><p class="caption">
<code>mpg</code> vs <code>horsepower</code> for the <code>Auto</code>
data
</p>
</div>
<p>The linear fit is clearly inappropriate; the fits for <span class="math inline">\(p = 2\)</span> (quadratic) through <span class="math inline">\(4\)</span> are very similar; and the fit for <span class="math inline">\(p = 5\)</span> probably over-fits the data by
chasing one or two relatively high <code>mpg</code> values at the
right.</p>
<p>The following graph shows two measures of estimated squared error as
a function of polynomial-regression degree: The mean-squared error
(MSE), defined as <span class="math inline">\(\mathsf{MSE} = \sum (y_i -
\widehat{y}_i)^2/n\)</span>, and the usual unbiased estimated error
variance, defined as <span class="math inline">\(\widehat{\sigma}^2 =
\sum (y_i - \widehat{y}_i)^2/(n - p - 1)\)</span>. The former
necessarily declines with <span class="math inline">\(p\)</span> (or,
more strictly, can’t increase with <span class="math inline">\(p\)</span>), while the latter gets slightly larger
for the largest values of <span class="math inline">\(p\)</span>, with
the “best” value, by a small margin, for <span class="math inline">\(p =
7\)</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://gmonette.github.io/cv/">"cv"</a></span><span class="op">)</span> <span class="co"># for mse() and other functions</span></span>
<span><span class="co">#&gt; Loading required package: doParallel</span></span>
<span><span class="co">#&gt; Loading required package: foreach</span></span>
<span><span class="co">#&gt; Loading required package: iterators</span></span>
<span><span class="co">#&gt; Loading required package: parallel</span></span>
<span></span>
<span><span class="va">se</span> <span class="op">&lt;-</span> <span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">horsepower</span>, <span class="va">p</span><span class="op">)</span>, data<span class="op">=</span><span class="va">Auto</span><span class="op">)</span></span>
<span>  <span class="va">mse</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cost-functions.html">mse</a></span><span class="op">(</span><span class="va">Auto</span><span class="op">$</span><span class="va">mpg</span>, <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">se</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">$</span><span class="va">sigma</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mse</span>, <span class="va">se</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"n"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Degree of polynomial, p"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Estimated Squared Error"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">mse</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="fl">2</span>, pch<span class="op">=</span><span class="fl">16</span>, type<span class="op">=</span><span class="st">"b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">se</span><span class="op">^</span><span class="fl">2</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">3</span>, pch<span class="op">=</span><span class="fl">17</span>, type<span class="op">=</span><span class="st">"b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, inset<span class="op">=</span><span class="fl">0.02</span>,</span>
<span>       legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">hat</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, <span class="st">"MSE"</span><span class="op">)</span>,</span>
<span>       lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">1</span>, col<span class="op">=</span><span class="fl">3</span><span class="op">:</span><span class="fl">2</span>, pch<span class="op">=</span><span class="fl">17</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/mpg-horsepower-MSE-se2-1.png" alt="Estimated squared error as a function of polynomial degree, $p$" width="100%"><p class="caption">
Estimated squared error as a function of polynomial degree, <span class="math inline">\(p\)</span>
</p>
</div>
<p>The code for this graph uses the <code><a href="../reference/cost-functions.html">mse()</a></code> function from the
<strong>cv</strong> package to compute the MSE for each fit.</p>
<div class="section level4">
<h4 id="using-cv">Using <code>cv()</code><a class="anchor" aria-label="anchor" href="#using-cv"></a>
</h4>
<p>The generic <code><a href="../reference/cv.html">cv()</a></code> function has an <code>"lm"</code>
method, which by default performs <span class="math inline">\(k =
10\)</span>-fold CV:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">horsepower</span>, <span class="fl">2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">Auto</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.auto</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = mpg ~ poly(horsepower, 2), data = Auto)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -14.714  -2.594  -0.086   2.287  15.896 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)            23.446      0.221   106.1   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; poly(horsepower, 2)1 -120.138      4.374   -27.5   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; poly(horsepower, 2)2   44.090      4.374    10.1   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 4.37 on 389 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.688,  Adjusted R-squared:  0.686 </span></span>
<span><span class="co">#&gt; F-statistic:  428 on 2 and 389 DF,  p-value: &lt;2e-16</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.auto</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 347890</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: mse</span></span>
<span><span class="co">#&gt; cross-validation criterion = 19.267</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 19.252</span></span>
<span><span class="co">#&gt; full-sample criterion = 18.985</span></span></code></pre></div>
<p>The <code>"lm"</code> method by default uses <code><a href="../reference/cost-functions.html">mse()</a></code> as
the CV criterion and the Woodbury matrix identity to update the
regression with each fold deleted without having literally to refit the
model. Computational details are discussed in the final section of this
vignette. The function reports the CV estimate of MSE, a biased-adjusted
estimate of the MSE (the bias adjustment is explained in the final
section), and the MSE is also computed for the original, full-sample
regression. Because the division of the data into 10 folds is random,
<code><a href="../reference/cv.html">cv()</a></code> explicitly (randomly) generates and saves a seed for
R’s pseudo-random number generator, to make the results replicable. The
user can also specify the seed directly via the <code>seed</code>
argument to <code><a href="../reference/cv.html">cv()</a></code>.</p>
<p>To perform LOO CV, we can set the <code>k</code> argument to
<code><a href="../reference/cv.html">cv()</a></code> to the number of cases in the data, here
<code>k=392</code>, or, more conveniently, to <code>k="loo"</code> or
<code>k="n"</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.auto</span>, k<span class="op">=</span><span class="st">"loo"</span><span class="op">)</span></span>
<span><span class="co">#&gt; n-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: hatvalues</span></span>
<span><span class="co">#&gt; criterion: mse</span></span>
<span><span class="co">#&gt; cross-validation criterion = 19.248</span></span></code></pre></div>
<p>For LOO CV of a linear model, <code><a href="../reference/cv.html">cv()</a></code> by default uses the
hatvalues from the model fit to the full data for the LOO updates, and
reports only the CV estimate of MSE. Alternative methods are to use the
Woodbury matrix identity or the “naive” approach of literally refitting
the model with each case omitted. All three methods produce exact
results for a linear model (within the precision of floating-point
computations):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.auto</span>, k<span class="op">=</span><span class="st">"loo"</span>, method<span class="op">=</span><span class="st">"naive"</span><span class="op">)</span></span>
<span><span class="co">#&gt; n-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: naive</span></span>
<span><span class="co">#&gt; criterion: mse</span></span>
<span><span class="co">#&gt; cross-validation criterion = 19.248</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 19.248</span></span>
<span><span class="co">#&gt; full-sample criterion = 18.985</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.auto</span>, k<span class="op">=</span><span class="st">"loo"</span>, method<span class="op">=</span><span class="st">"Woodbury"</span><span class="op">)</span></span>
<span><span class="co">#&gt; n-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: mse</span></span>
<span><span class="co">#&gt; cross-validation criterion = 19.248</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 19.248</span></span>
<span><span class="co">#&gt; full-sample criterion = 18.985</span></span></code></pre></div>
<p>The <code>"naive"</code> and <code>"Woodbury"</code> methods also
return the bias-adjusted estimate of MSE and the full-sample MSE, but
bias isn’t an issue for LOO CV.</p>
<p>This is a small regression problem and all three computational
approaches are essentially instantaneous, but it is still of interest to
investigate their relative speed. In this comparison, we include the
<code><a href="../reference/cv.html">cv.glm()</a></code> function from the <strong>boot</strong> package,
which takes the naive approach, and for which we have to fit the linear
model as an equivalent Gaussian GLM. We use the
<code>microbenchmark()</code> function from the package of the same name
for the timings <span class="citation">(Mersmann, 2023)</span>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.auto.glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">horsepower</span>, <span class="fl">2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">Auto</span><span class="op">)</span></span>
<span><span class="fu">boot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/boot/man/cv.glm.html" class="external-link">cv.glm</a></span><span class="op">(</span><span class="va">Auto</span>, <span class="va">m.auto.glm</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span></span>
<span><span class="co">#&gt; [1] 19.248 19.248</span></span>
<span></span>
<span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  hatvalues <span class="op">=</span> <span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.auto</span>, k<span class="op">=</span><span class="st">"loo"</span><span class="op">)</span>,</span>
<span>  Woodbury <span class="op">=</span> <span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.auto</span>, k<span class="op">=</span><span class="st">"loo"</span>, method<span class="op">=</span><span class="st">"Woodbury"</span><span class="op">)</span>,</span>
<span>  naive <span class="op">=</span> <span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.auto</span>, k<span class="op">=</span><span class="st">"loo"</span>, method<span class="op">=</span><span class="st">"naive"</span><span class="op">)</span>,</span>
<span>  cv.glm <span class="op">=</span> <span class="fu">boot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/boot/man/cv.glm.html" class="external-link">cv.glm</a></span><span class="op">(</span><span class="va">Auto</span>, <span class="va">m.auto.glm</span><span class="op">)</span>,</span>
<span>  times<span class="op">=</span><span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;       expr       min        lq      mean    median        uq       max neval</span></span>
<span><span class="co">#&gt;  hatvalues    2.5766    2.6297    2.8508    2.8453    2.9872    3.2463    10</span></span>
<span><span class="co">#&gt;   Woodbury   26.0500   26.3016   26.6310   26.5162   26.6249   28.4217    10</span></span>
<span><span class="co">#&gt;      naive  604.9584  605.3650  633.0476  607.7607  609.2521  737.7820    10</span></span>
<span><span class="co">#&gt;     cv.glm 1045.4301 1053.8210 1080.1043 1056.0464 1058.6553 1190.4777    10</span></span></code></pre></div>
<p>On our computer, using the hatvalues is about an order of magnitude
faster than employing Woodbury matrix updates, and more than two orders
of magnitude faster than refitting the model.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Out of impatience, we asked
&lt;code&gt;microbenchmark()&lt;/code&gt; to execute each command only 10 times
rather than the default 100. With the exception of the last columns, the
output is self-explanatory. The last column shows which methods have
average timings that are statistically distinguishable. Because of the
small number of repetitions (i.e., 10), the &lt;code&gt;"hatvalues"&lt;/code&gt; and
&lt;code&gt;"Woodbury"&lt;/code&gt; methods aren’t distinguishable, but the
difference between these methods persists when we perform more
repetitions—we invite the reader to redo this computation with the
default &lt;code&gt;times=100&lt;/code&gt; repetitions.&lt;/p&gt;'><sup>3</sup></a></p>
</div>
<div class="section level4">
<h4 id="comparing-competing-models">Comparing Competing Models<a class="anchor" aria-label="anchor" href="#comparing-competing-models"></a>
</h4>
<p>The <code><a href="../reference/cv.html">cv()</a></code> function also has a method that can be applied
to a list of regression models for the same data, composed using the
<code><a href="../reference/models.html">models()</a></code> function. For <span class="math inline">\(k\)</span>-fold CV, the same folds are used for
the competing models, which reduces random error in their comparison.
This result can also be obtained by specifying a common seed for R’s
random-number generator while applying <code><a href="../reference/cv.html">cv()</a></code> separately to
each model, but employing a list of models is more convenient for both
<span class="math inline">\(k\)</span>-fold and LOO CV (where there is
no random component to the composition of the <span class="math inline">\(n\)</span> folds).</p>
<p>We illustrate with the polynomial regression models of varying degree
for the <code>Auto</code> data (discussed previously), beginning by
fitting and saving the 10 models:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"m."</span>, <span class="va">p</span><span class="op">)</span>,</span>
<span>         <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="va">horsepower</span>, <span class="va">p</span><span class="op">)</span>, data<span class="op">=</span><span class="va">Auto</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">objects</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"m\\.[0-9]"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "m.1"  "m.10" "m.2"  "m.3"  "m.4"  "m.5"  "m.6"  "m.7"  "m.8"  "m.9"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.2</span><span class="op">)</span> <span class="co"># for example, the quadratic fit</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = mpg ~ poly(horsepower, p), data = Auto)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -14.714  -2.594  -0.086   2.287  15.896 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                      Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)            23.446      0.221   106.1   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; poly(horsepower, p)1 -120.138      4.374   -27.5   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; poly(horsepower, p)2   44.090      4.374    10.1   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 4.37 on 389 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.688,  Adjusted R-squared:  0.686 </span></span>
<span><span class="co">#&gt; F-statistic:  428 on 2 and 389 DF,  p-value: &lt;2e-16</span></span></code></pre></div>
<p>We then apply <code><a href="../reference/cv.html">cv()</a></code> to the list of 10 models (the
<code>data</code> argument is required):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 10-fold CV</span></span>
<span><span class="va">cv.auto.10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="fu"><a href="../reference/models.html">models</a></span><span class="op">(</span><span class="va">m.1</span>, <span class="va">m.2</span>, <span class="va">m.3</span>, <span class="va">m.4</span>, <span class="va">m.5</span>,</span>
<span>                     <span class="va">m.6</span>, <span class="va">m.7</span>, <span class="va">m.8</span>, <span class="va">m.9</span>, <span class="va">m.10</span><span class="op">)</span>,</span>
<span>              data<span class="op">=</span><span class="va">Auto</span>, seed<span class="op">=</span><span class="fl">2120</span><span class="op">)</span></span>
<span><span class="va">cv.auto.10</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="co"># for the linear and quadratic models</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model model.1:</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; cross-validation criterion = 24.246</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 24.23</span></span>
<span><span class="co">#&gt; full-sample criterion = 23.944 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model model.2:</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; cross-validation criterion = 19.346</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 19.327</span></span>
<span><span class="co">#&gt; full-sample criterion = 18.985</span></span>
<span></span>
<span><span class="co"># LOO CV</span></span>
<span><span class="va">cv.auto.loo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="fu"><a href="../reference/models.html">models</a></span><span class="op">(</span><span class="va">m.1</span>, <span class="va">m.2</span>, <span class="va">m.3</span>, <span class="va">m.4</span>, <span class="va">m.5</span>,</span>
<span>                        <span class="va">m.6</span>, <span class="va">m.7</span>, <span class="va">m.8</span>, <span class="va">m.9</span>, <span class="va">m.10</span><span class="op">)</span>,</span>
<span>                 data<span class="op">=</span><span class="va">Auto</span>, k<span class="op">=</span><span class="st">"loo"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span></span>
<span><span class="co">#&gt; Warning in cv.lm(model[[i]], data = data, criterion = criterion, k = k, : seed</span></span>
<span><span class="co">#&gt; ignored for n-fold CV</span></span>
<span><span class="va">cv.auto.loo</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="co"># linear and quadratic models</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model model.1:</span></span>
<span><span class="co">#&gt; n-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: hatvalues</span></span>
<span><span class="co">#&gt; cross-validation criterion = 24.232</span></span>
<span><span class="co">#&gt; Model model.2:</span></span>
<span><span class="co">#&gt; n-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: hatvalues</span></span>
<span><span class="co">#&gt; cross-validation criterion = 19.248</span></span></code></pre></div>
<p>Because we didn’t supply names for the models in the calls to the
<code><a href="../reference/models.html">models()</a></code> function, the names <code>model.1</code>,
<code>model.2</code>, etc., are supplied by the function.</p>
<p>Finally, we extract and graph the adjusted MSEs for <span class="math inline">\(10\)</span>-fold CV and the MSEs for LOO CV:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv.mse.10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cv.auto.10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[[</span><span class="st">"adj CV crit"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">cv.mse.loo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cv.auto.loo</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[[</span><span class="st">"CV crit"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">cv.mse.10</span>, <span class="va">cv.mse.loo</span><span class="op">)</span>, type<span class="op">=</span><span class="st">"n"</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Degree of polynomial, p"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Cross-Validated MSE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">cv.mse.10</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="fl">2</span>, pch<span class="op">=</span><span class="fl">16</span>, type<span class="op">=</span><span class="st">"b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">cv.mse.loo</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">3</span>, pch<span class="op">=</span><span class="fl">17</span>, type<span class="op">=</span><span class="st">"b"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, inset<span class="op">=</span><span class="fl">0.02</span>,</span>
<span>       legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10-Fold CV"</span>, <span class="st">"LOO CV"</span><span class="op">)</span>,</span>
<span>       lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">1</span>, col<span class="op">=</span><span class="fl">3</span><span class="op">:</span><span class="fl">2</span>, pch<span class="op">=</span><span class="fl">17</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/polynomial-regression-CV-graph-1.png" alt="Cross-validated 10-fold and LOO MSE as a function of polynomial degree, $p$" width="100%"><p class="caption">
Cross-validated 10-fold and LOO MSE as a function of polynomial degree,
<span class="math inline">\(p\)</span>
</p>
</div>
<p>Alternatively, we can use the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method for
<code>"cvModList"</code> objects to compare the models, though with
separate graphs for 10-fold and LOO CV:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv.auto.10</span>, main<span class="op">=</span><span class="st">"Polynomial Regressions, 10-Fold CV"</span>,</span>
<span>     axis.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"Degree of Polynomial, p"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv.auto.loo</span>, main<span class="op">=</span><span class="st">"Polynomial Regressions, LOO CV"</span>,</span>
<span>     axis.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, xlab<span class="op">=</span><span class="st">"Degree of Polynomial, p"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/polynomial-regression-CV-graph-2-1.png" alt="Cross-validated 10-fold and LOO MSE as a function of polynomial degree, $p$" width="45%"><img src="fig/polynomial-regression-CV-graph-2-2.png" alt="Cross-validated 10-fold and LOO MSE as a function of polynomial degree, $p$" width="45%"><p class="caption">
Cross-validated 10-fold and LOO MSE as a function of polynomial degree,
<span class="math inline">\(p\)</span>
</p>
</div>
<p>In this example, 10-fold and LOO CV produce generally similar
results, and also results that are similar to those produced by the
estimated error variance <span class="math inline">\(\widehat{\sigma}^2\)</span> for each model,
reported above (except for the highest-degree polynomials, where the CV
results more clearly suggest over-fitting).</p>
</div>
</div>
<div class="section level3">
<h3 id="logistic-regression-for-the-mroz-data">Logistic regression for the <code>Mroz</code> data<a class="anchor" aria-label="anchor" href="#logistic-regression-for-the-mroz-data"></a>
</h3>
<p>The <code>Mroz</code> data set from the <strong>carData</strong>
package <span class="citation">(associated with Fox &amp; Weisberg,
2019)</span> has been used by several authors to illustrate binary
logistic regression; see, in particular <span class="citation">Fox &amp;
Weisberg (2019)</span>. The data were originally drawn from the U.S.
Panel Study of Income Dynamics and pertain to married women. Here are a
few cases in the data set:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Mroz"</span>, package<span class="op">=</span><span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Mroz</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;   lfp k5 k618 age wc hc    lwg   inc</span></span>
<span><span class="co">#&gt; 1 yes  1    0  32 no no 1.2102 10.91</span></span>
<span><span class="co">#&gt; 2 yes  0    2  30 no no 0.3285 19.50</span></span>
<span><span class="co">#&gt; 3 yes  1    3  35 no no 1.5141 12.04</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">Mroz</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt;     lfp k5 k618 age wc hc     lwg    inc</span></span>
<span><span class="co">#&gt; 751  no  0    0  43 no no 0.88814  9.952</span></span>
<span><span class="co">#&gt; 752  no  0    0  60 no no 1.22497 24.984</span></span>
<span><span class="co">#&gt; 753  no  0    3  39 no no 0.85321 28.363</span></span></code></pre></div>
<p>The response variable in the logistic regression is <code>lfp</code>,
labor-force participation, a factor coded <code>"yes"</code> or
<code>"no"</code>. The remaining variables are predictors:</p>
<ul>
<li>
<code>k5</code>, number of children 5 years old of younger in the
woman’s household;</li>
<li>
<code>k618</code>, number of children between 6 and 18 years
old;</li>
<li>
<code>age</code>, in years;</li>
<li>
<code>wc</code>, wife’s college attendance, <code>"yes"</code> or
<code>"no"</code>;</li>
<li>
<code>hc</code>, husband’s college attendance;</li>
<li>
<code>lwg</code>, the woman’s log wage rate if she is employed, or
her <em>imputed</em> wage rate, if she is not <span class="citation">(a
variable that Fox &amp; Weisberg, 2019 show is problematically
defined)</span>; and</li>
<li>
<code>inc</code>, family income, in $1000s, exclusive of wife’s
income.</li>
</ul>
<p>We use the <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> function to fit a binary logistic
regression to the <code>Mroz</code> data:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.mroz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">lfp</span> <span class="op">~</span> <span class="va">.</span>, data<span class="op">=</span><span class="va">Mroz</span>, family<span class="op">=</span><span class="va">binomial</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.mroz</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = lfp ~ ., family = binomial, data = Mroz)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  3.18214    0.64438    4.94  7.9e-07 ***</span></span>
<span><span class="co">#&gt; k5          -1.46291    0.19700   -7.43  1.1e-13 ***</span></span>
<span><span class="co">#&gt; k618        -0.06457    0.06800   -0.95  0.34234    </span></span>
<span><span class="co">#&gt; age         -0.06287    0.01278   -4.92  8.7e-07 ***</span></span>
<span><span class="co">#&gt; wcyes        0.80727    0.22998    3.51  0.00045 ***</span></span>
<span><span class="co">#&gt; hcyes        0.11173    0.20604    0.54  0.58762    </span></span>
<span><span class="co">#&gt; lwg          0.60469    0.15082    4.01  6.1e-05 ***</span></span>
<span><span class="co">#&gt; inc         -0.03445    0.00821   -4.20  2.7e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1029.75  on 752  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:  905.27  on 745  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 921.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cost-functions.html">BayesRule</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">Mroz</span><span class="op">$</span><span class="va">lfp</span> <span class="op">==</span> <span class="st">"yes"</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">m.mroz</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.30677</span></span></code></pre></div>
<p>In addition to the usually summary output for a GLM, we show the
result of applying the <code><a href="../reference/cost-functions.html">BayesRule()</a></code> function from the
<strong>cv</strong> package to predictions derived from the fitted
model. Bayes rule, which predicts a “success” in a binary regression
model when the fitted probability of success [i.e., <span class="math inline">\(\phi = \Pr(y = 1)\)</span>] is <span class="math inline">\(\widehat{\phi} \ge .5\)</span> and a “failure” if
<span class="math inline">\(\widehat{\phi} \lt .5\)</span>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;&lt;a href="../reference/cost-functions.html"&gt;BayesRule()&lt;/a&gt;&lt;/code&gt; does some error checking;
&lt;code&gt;&lt;a href="../reference/cost-functions.html"&gt;BayesRule2()&lt;/a&gt;&lt;/code&gt; is similar, but omits the error checking, and
so can be faster for large problems.&lt;/p&gt;'><sup>4</sup></a> The first
argument to <code><a href="../reference/cost-functions.html">BayesRule()</a></code> is the binary {0, 1} response, and
the second argument is the predicted probability of success.
<code><a href="../reference/cost-functions.html">BayesRule()</a></code> returns the proportion of predictions that are
<em>in error</em>, as appropriate for a “cost” function.</p>
<p>In this example, the fitted logistic regression incorrectly predicts
31% of the responses; we expect this estimate to be optimistic given
that the model is used to “predict” the data to which it is fit.</p>
<p>The <code>"glm"</code> method for <code><a href="../reference/cv.html">cv()</a></code> is largely
similar to the <code>"lm"</code> method, although the default algorithm,
selected explicitly by <code>method="exact"</code>, refits the model
with each fold removed (and is thus equivalent to
<code>method="naive"</code> for <code>"lm"</code> models). For
generalized linear models, <code>method="Woodbury"</code> or (for LOO
CV) <code>method="hatvalues"</code> provide approximate results (see the
last section of the vignette for details):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz</span>, criterion<span class="op">=</span><span class="va">BayesRule</span>, seed<span class="op">=</span><span class="fl">248</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 248</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: exact</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.32404</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.31952</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz</span>, criterion<span class="op">=</span><span class="va">BayesRule</span>, seed<span class="op">=</span><span class="fl">248</span>, method<span class="op">=</span><span class="st">"Woodbury"</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 248</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.32404</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.31926</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677</span></span></code></pre></div>
<p>To ensure that the two methods use the same 10 folds, we specify the
seed for R’s random-number generator explicitly; here, and as is common
in our experience, the <code>"exact"</code> and <code>"Woodbury"</code>
algorithms produce nearly identical results. The CV estimates of
prediction error are slightly higher than the estimate based on all of
the cases.</p>
<p>Here are results of applying LOO CV to the Mroz model, using both the
exact and the approximate methods:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz</span>, k<span class="op">=</span><span class="st">"loo"</span>, criterion<span class="op">=</span><span class="va">BayesRule</span><span class="op">)</span></span>
<span><span class="co">#&gt; n-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: exact</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.32005</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.3183</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz</span>, k<span class="op">=</span><span class="st">"loo"</span>, criterion<span class="op">=</span><span class="va">BayesRule</span>, method<span class="op">=</span><span class="st">"Woodbury"</span><span class="op">)</span></span>
<span><span class="co">#&gt; n-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.32005</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.3183</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz</span>, k<span class="op">=</span><span class="st">"loo"</span>, criterion<span class="op">=</span><span class="va">BayesRule</span>, method<span class="op">=</span><span class="st">"hatvalues"</span><span class="op">)</span></span>
<span><span class="co">#&gt; n-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: hatvalues</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.32005</span></span></code></pre></div>
<p>To the number of decimal digits shown, the three methods produce
identical results for this example.</p>
<p>As for linear models, we report some timings for the various
<code><a href="../reference/cv.html">cv()</a></code> methods of computation in LOO CV as well as for the
<code><a href="../reference/cv.html">cv.glm()</a></code> function from the <strong>boot</strong> package
(which, recall, refits the model with each case removed, and thus is
comparable to <code><a href="../reference/cv.html">cv()</a></code> with <code>method="exact"</code>):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">microbenchmark</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html" class="external-link">microbenchmark</a></span><span class="op">(</span></span>
<span>  hatvalues<span class="op">=</span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz</span>, k<span class="op">=</span><span class="st">"loo"</span>, criterion<span class="op">=</span><span class="va">BayesRule</span>, method<span class="op">=</span><span class="st">"hatvalues"</span><span class="op">)</span>,</span>
<span>  Woodbury<span class="op">=</span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz</span>, k<span class="op">=</span><span class="st">"loo"</span>, criterion<span class="op">=</span><span class="va">BayesRule</span>, method<span class="op">=</span><span class="st">"Woodbury"</span><span class="op">)</span>,</span>
<span>  exact<span class="op">=</span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz</span>, k<span class="op">=</span><span class="st">"loo"</span>, criterion<span class="op">=</span><span class="va">BayesRule</span><span class="op">)</span>,</span>
<span>  cv.glm<span class="op">=</span><span class="fu">boot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/boot/man/cv.glm.html" class="external-link">cv.glm</a></span><span class="op">(</span><span class="va">Mroz</span>, <span class="va">m.mroz</span>,</span>
<span>               cost<span class="op">=</span><span class="va">BayesRule</span><span class="op">)</span>,</span>
<span>  times<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Unit: milliseconds</span></span>
<span><span class="co">#&gt;       expr       min        lq      mean    median        uq       max neval</span></span>
<span><span class="co">#&gt;  hatvalues    2.9899    3.0782    3.1417    3.0983    3.1915    3.4498    10</span></span>
<span><span class="co">#&gt;   Woodbury   85.4767   86.1659   87.5011   86.8270   88.3236   93.2043    10</span></span>
<span><span class="co">#&gt;      exact 3788.5080 3866.2393 3901.4011 3887.0441 3946.7847 4001.5386    10</span></span>
<span><span class="co">#&gt;     cv.glm 4605.8720 4633.4357 4703.3759 4720.2269 4770.4300 4783.7866    10</span></span></code></pre></div>
<p>There is a substantial time penalty associated with exact
computations.</p>
</div>
</div>
<div class="section level2">
<h2 id="cross-validating-mixed-effects-models">Cross-validating mixed-effects models<a class="anchor" aria-label="anchor" href="#cross-validating-mixed-effects-models"></a>
</h2>
<p>The fundamental analogy for cross-validation is to the collection of
new data. That is, predicting the response in each fold from the model
fit to data in the other folds is like using the model fit to all of the
data to predict the response for new cases from the values of the
predictors for those new cases. As we explained, the application of this
idea to independently sampled cases is straightforward—simply partition
the data into random folds of equal size and leave each fold out in
turn, or, in the case of LOO CV, simply omit each case in turn.</p>
<p>In contrast, mixed-effects models are fit to <em>dependent</em> data,
in which cases as clustered, such as hierarchical data, where the
clusters comprise higher-level units (e.g., students clustered in
schools), or longitudinal data, where the clusters are individuals and
the cases repeated observations on the individuals over time.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;There are, however, more complex situations that give
rise to so-called &lt;em&gt;crossed&lt;/em&gt; (rather than &lt;em&gt;nested&lt;/em&gt;) random
effects. For example, consider students within classes within schools.
In primary schools, students typically are in a single class, and so
classes are nested within schools. In secondary schools, however,
students typically take several classes and students who are together in
a particular class may not be together in other classes; consequently,
random effects based on classes within schools are crossed. Although the
&lt;code&gt;&lt;a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link"&gt;lmer()&lt;/a&gt;&lt;/code&gt; function in the &lt;strong&gt;lme4&lt;/strong&gt; package is
capable of modeling both nested and crossed random effects, the
&lt;code&gt;&lt;a href="../reference/cv.html"&gt;cv()&lt;/a&gt;&lt;/code&gt; methods for mixed models in the &lt;strong&gt;cv&lt;/strong&gt;
package pertain only to nested random effects. It may be possible to
cross-validate mixed models with crossed random effects, but we don’t
know how to do it.&lt;/p&gt;'><sup>5</sup></a></p>
<p>We can think of two approaches to applying cross-validation to
clustered data:</p>
<ol style="list-style-type: decimal">
<li><p>Treat CV as analogous to predicting the response for one or more
cases in a <em>newly observed cluster</em>. In this instance, the folds
comprise one or more whole clusters; we refit the model with all of the
cases in clusters in the current fold removed; and then we predict the
response for the cases in clusters in the current fold. These
predictions are based only on fixed effects because the random effects
for the omitted clusters are presumably unknown, as they would be for
data on cases in newly observed clusters.</p></li>
<li><p>Treat CV as analogous to predicting the response for a newly
observed case in an <em>existing cluster</em>. In this instance, the
folds comprise one or more individual cases, and the predictions can use
both the fixed and random effects.</p></li>
</ol>
<div class="section level3">
<h3 id="example-the-high-school-and-beyond-data">Example: The High-School and Beyond data<a class="anchor" aria-label="anchor" href="#example-the-high-school-and-beyond-data"></a>
</h3>
<p>Following their use by <span class="citation">Raudenbush &amp; Bryk
(2002)</span>, data from the 1982 <em>High School and Beyond</em> (HSB)
survey have become a staple of the literature on mixed-effects models.
The HSB data are used by <span class="citation">Fox &amp; Weisberg
(2019, sec. 7.2.2)</span> to illustrate the application of linear mixed
models to hierarchical data, and we’ll closely follow their example
here.</p>
<p>The HSB data are included in the <code>MathAchieve</code> and
<code>MathAchSchool</code> data sets in the <strong>nlme</strong>
package <span class="citation">(Pinheiro &amp; Bates, 2000)</span>.
<code>MathAchieve</code> includes individual-level data on 7185 students
in 160 high schools, and <code>MathAchSchool</code> includes
school-level data:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"MathAchieve"</span>, package<span class="op">=</span><span class="st">"nlme"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">MathAchieve</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7185    6</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">MathAchieve</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Grouped Data: MathAch ~ SES | School</span></span>
<span><span class="co">#&gt;   School Minority    Sex    SES MathAch MEANSES</span></span>
<span><span class="co">#&gt; 1   1224       No Female -1.528   5.876  -0.428</span></span>
<span><span class="co">#&gt; 2   1224       No Female -0.588  19.708  -0.428</span></span>
<span><span class="co">#&gt; 3   1224       No   Male -0.528  20.349  -0.428</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">MathAchieve</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Grouped Data: MathAch ~ SES | School</span></span>
<span><span class="co">#&gt;      School Minority    Sex    SES MathAch MEANSES</span></span>
<span><span class="co">#&gt; 7183   9586       No Female  1.332  19.641   0.627</span></span>
<span><span class="co">#&gt; 7184   9586       No Female -0.008  16.241   0.627</span></span>
<span><span class="co">#&gt; 7185   9586       No Female  0.792  22.733   0.627</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"MathAchSchool"</span>, package<span class="op">=</span><span class="st">"nlme"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">MathAchSchool</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 160   7</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">MathAchSchool</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;      School Size Sector PRACAD DISCLIM HIMINTY MEANSES</span></span>
<span><span class="co">#&gt; 1224   1224  842 Public   0.35   1.597       0  -0.428</span></span>
<span><span class="co">#&gt; 1288   1288 1855 Public   0.27   0.174       0   0.128</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">MathAchSchool</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;      School Size   Sector PRACAD DISCLIM HIMINTY MEANSES</span></span>
<span><span class="co">#&gt; 9550   9550 1532   Public   0.45   0.791       0   0.059</span></span>
<span><span class="co">#&gt; 9586   9586  262 Catholic   1.00  -2.416       0   0.627</span></span></code></pre></div>
<p>The first few students are in school number 1224 and the last few in
school 9586.</p>
<p>We’ll use only the <code>School</code>, <code>SES</code> (students’
socioeconomic status), and <code>MathAch</code> (their score on a
standardized math-achievement test) variables in the
<code>MathAchieve</code> data set, and <code>Sector</code>
(<code>"Catholic"</code> or <code>"Public"</code>) in the
<code>MathAchSchool</code> data set.</p>
<p>Some data-management is required before fitting a mixed-effects model
to the HSB data, for which we use the <strong>dplyr</strong> package
<span class="citation">(Wickham, François, Henry, Müller, &amp; Vaughan,
2023)</span>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="va">MathAchieve</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">School</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean.ses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">SES</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">Temp</span></span>
<span><span class="va">Temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">MathAchSchool</span>, <span class="va">Temp</span>, by<span class="op">=</span><span class="st">"School"</span><span class="op">)</span></span>
<span><span class="va">HSB</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">Temp</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"School"</span>, <span class="st">"Sector"</span>, <span class="st">"mean.ses"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>             <span class="va">MathAchieve</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"School"</span>, <span class="st">"SES"</span>, <span class="st">"MathAch"</span><span class="op">)</span><span class="op">]</span>, by<span class="op">=</span><span class="st">"School"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">HSB</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">HSB</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">HSB</span><span class="op">$</span><span class="va">cses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">HSB</span>, <span class="va">ses</span> <span class="op">-</span> <span class="va">mean.ses</span><span class="op">)</span></span></code></pre></div>
<p>In the process, we created two new school-level variables:
<code>meanses</code>, which is the average SES for students in each
school; and <code>cses</code>, which is school-average SES centered at
its mean. For details, see <span class="citation">Fox &amp; Weisberg
(2019, sec. 7.2.2)</span>.</p>
<p>Still following Fox and Weisberg, we proceed to use the
<code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer()</a></code> function in the <strong>lme4</strong> package <span class="citation">(Bates, Mächler, Bolker, &amp; Walker, 2015)</span> to
fit a mixed model for math achievement to the HSB data:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/lme4/lme4/" class="external-link">"lme4"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span>
<span><span class="va">hsb.lmer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">mathach</span> <span class="op">~</span> <span class="va">mean.ses</span><span class="op">*</span><span class="va">cses</span> <span class="op">+</span> <span class="va">sector</span><span class="op">*</span><span class="va">cses</span></span>
<span>                   <span class="op">+</span> <span class="op">(</span><span class="va">cses</span> <span class="op">|</span> <span class="va">school</span><span class="op">)</span>, data<span class="op">=</span><span class="va">HSB</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hsb.lmer</span>, correlation<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: mathach ~ mean.ses * cses + sector * cses + (cses | school)</span></span>
<span><span class="co">#&gt;    Data: HSB</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 46504</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -3.159 -0.723  0.017  0.754  2.958 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev. Corr</span></span>
<span><span class="co">#&gt;  school   (Intercept)  2.380   1.543        </span></span>
<span><span class="co">#&gt;           cses         0.101   0.318    0.39</span></span>
<span><span class="co">#&gt;  Residual             36.721   6.060        </span></span>
<span><span class="co">#&gt; Number of obs: 7185, groups:  school, 160</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;                     Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)           12.128      0.199   60.86</span></span>
<span><span class="co">#&gt; mean.ses               5.333      0.369   14.45</span></span>
<span><span class="co">#&gt; cses                   2.945      0.156   18.93</span></span>
<span><span class="co">#&gt; sectorCatholic         1.227      0.306    4.00</span></span>
<span><span class="co">#&gt; mean.ses:cses          1.039      0.299    3.48</span></span>
<span><span class="co">#&gt; cses:sectorCatholic   -1.643      0.240   -6.85</span></span></code></pre></div>
<p>We can then cross-validate at the cluster (i.e., school) level,</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">hsb.lmer</span>, k<span class="op">=</span><span class="fl">10</span>, clusterVariables<span class="op">=</span><span class="st">"school"</span>, seed<span class="op">=</span><span class="fl">5240</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 5240</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation based on 160 {school} clusters</span></span>
<span><span class="co">#&gt; cross-validation criterion = 39.133</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 39.125</span></span>
<span><span class="co">#&gt; full-sample criterion = 39.006</span></span></code></pre></div>
<p>or at the case (i.e., student) level,</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">hsb.lmer</span>, seed<span class="op">=</span><span class="fl">1575</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 1575</span></span>
<span><span class="co">#&gt; Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :</span></span>
<span><span class="co">#&gt; Model failed to converge with max|grad| = 0.00587141 (tol = 0.002, component 1)</span></span>
<span><span class="co">#&gt; boundary (singular) fit: see help('isSingular')</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; cross-validation criterion = 37.445</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 37.338</span></span>
<span><span class="co">#&gt; full-sample criterion = 36.068</span></span></code></pre></div>
<p>For cluster-level CV, the <code>clusterVariables</code> argument
tells <code><a href="../reference/cv.html">cv()</a></code> how the clusters are defined. Were there more
than one clustering variable, say classes within schools, these would be
provided as a character vector of variable names:
<code>clusterVariables = c("school", "class")</code>. For cluster-level
CV, the default is <code>k = "loo"</code>, that is, leave one cluster
out at a time; we instead specify <code>k = 10</code> folds of clusters,
each fold therefore comprising <span class="math inline">\(160/10 =
16\)</span> schools.</p>
<p>If the <code>clusterVariables</code> argument is omitted, then
case-level CV is employed, with <code>k = 10</code> folds as the
default, here each with <span class="math inline">\(7185/10 \approx
719\)</span> students. Notice that one of the 10 models refit with a
fold removed failed to converge. Convergence problems are common in
mixed-effects modeling. The apparent issue here is that an estimated
variance component is close to or equal to 0, which is at a boundary of
the parameter space. That shouldn’t disqualify the fitted model for the
kind of prediction required for cross-validation.</p>
<p>There is also a <code><a href="../reference/cv.html">cv()</a></code> method for linear mixed models fit
by the <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme()</a></code> function in the <strong>nlme</strong> package,
and the arguments for <code><a href="../reference/cv.html">cv()</a></code> in this case are the same as for
a model fit by <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer()</a></code> or <code><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">glmer()</a></code>. We
illustrate with the mixed model fit to the HSB data:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">"nlme"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'nlme'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:lme4':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     lmList</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     collapse</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:cv':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     getResponse</span></span>
<span><span class="va">hsb.lme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme</a></span><span class="op">(</span><span class="va">mathach</span> <span class="op">~</span> <span class="va">mean.ses</span><span class="op">*</span><span class="va">cses</span> <span class="op">+</span> <span class="va">sector</span><span class="op">*</span><span class="va">cses</span>,</span>
<span>                 random <span class="op">=</span> <span class="op">~</span> <span class="va">cses</span> <span class="op">|</span> <span class="va">school</span>, data<span class="op">=</span><span class="va">HSB</span>,</span>
<span>               control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>opt<span class="op">=</span><span class="st">"optim"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hsb.lme</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed-effects model fit by REML</span></span>
<span><span class="co">#&gt;   Data: HSB </span></span>
<span><span class="co">#&gt;     AIC   BIC logLik</span></span>
<span><span class="co">#&gt;   46525 46594 -23252</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Formula: ~cses | school</span></span>
<span><span class="co">#&gt;  Structure: General positive-definite, Log-Cholesky parametrization</span></span>
<span><span class="co">#&gt;             StdDev   Corr  </span></span>
<span><span class="co">#&gt; (Intercept) 1.541177 (Intr)</span></span>
<span><span class="co">#&gt; cses        0.018174 0.006 </span></span>
<span><span class="co">#&gt; Residual    6.063492       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:  mathach ~ mean.ses * cses + sector * cses </span></span>
<span><span class="co">#&gt;                       Value Std.Error   DF t-value p-value</span></span>
<span><span class="co">#&gt; (Intercept)         12.1282   0.19920 7022  60.886   0e+00</span></span>
<span><span class="co">#&gt; mean.ses             5.3367   0.36898  157  14.463   0e+00</span></span>
<span><span class="co">#&gt; cses                 2.9421   0.15122 7022  19.456   0e+00</span></span>
<span><span class="co">#&gt; sectorCatholic       1.2245   0.30611  157   4.000   1e-04</span></span>
<span><span class="co">#&gt; mean.ses:cses        1.0444   0.29107 7022   3.588   3e-04</span></span>
<span><span class="co">#&gt; cses:sectorCatholic -1.6421   0.23312 7022  -7.044   0e+00</span></span>
<span><span class="co">#&gt;  Correlation: </span></span>
<span><span class="co">#&gt;                     (Intr) men.ss cses   sctrCt mn.ss:</span></span>
<span><span class="co">#&gt; mean.ses             0.256                            </span></span>
<span><span class="co">#&gt; cses                 0.000  0.000                     </span></span>
<span><span class="co">#&gt; sectorCatholic      -0.699 -0.356  0.000              </span></span>
<span><span class="co">#&gt; mean.ses:cses        0.000  0.000  0.295  0.000       </span></span>
<span><span class="co">#&gt; cses:sectorCatholic  0.000  0.000 -0.696  0.000 -0.351</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Standardized Within-Group Residuals:</span></span>
<span><span class="co">#&gt;       Min        Q1       Med        Q3       Max </span></span>
<span><span class="co">#&gt; -3.170106 -0.724877  0.014892  0.754263  2.965498 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Observations: 7185</span></span>
<span><span class="co">#&gt; Number of Groups: 160</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">hsb.lme</span>, k<span class="op">=</span><span class="fl">10</span>, clusterVariables<span class="op">=</span><span class="st">"school"</span>, seed<span class="op">=</span><span class="fl">5240</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 5240</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation based on 160 {school} clusters</span></span>
<span><span class="co">#&gt; cross-validation criterion = 39.133</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 39.125</span></span>
<span><span class="co">#&gt; full-sample criterion = 39.006</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">hsb.lme</span>, seed<span class="op">=</span><span class="fl">1575</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 1575</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; cross-validation criterion = 37.442</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 37.402</span></span>
<span><span class="co">#&gt; full-sample criterion = 36.147</span></span></code></pre></div>
<p>We used the same random-number generator seeds as in the previous
example cross-validating the model fit by <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer()</a></code>, and so
the same folds are employed in both cases.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;The observant reader will notice that we set the
argument &lt;code&gt;control=list(opt="optim")&lt;/code&gt; in the call to
&lt;code&gt;&lt;a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link"&gt;lme()&lt;/a&gt;&lt;/code&gt;, changing the optimizer employed from the default
&lt;code&gt;"nlminb"&lt;/code&gt;. We did this because with the default optimizer,
&lt;code&gt;&lt;a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link"&gt;lme()&lt;/a&gt;&lt;/code&gt; encountered the same convergence issue as
&lt;code&gt;&lt;a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link"&gt;lmer()&lt;/a&gt;&lt;/code&gt;, but rather than issuing a warning,
&lt;code&gt;&lt;a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link"&gt;lme()&lt;/a&gt;&lt;/code&gt; failed, reporting an error. As it turns out, setting
the optimizer to &lt;code&gt;"optim"&lt;/code&gt; avoids this problem.&lt;/p&gt;'><sup>6</sup></a> The estimated
covariance components and fixed effects in the summary output differ
slightly between the <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer()</a></code> and <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme()</a></code>
solutions, although both functions seek to maximize the REML criterion.
This is, of course, to be expected when different algorithms are used
for numerical optimization. To the precision reported, the cluster-level
CV results for the <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer()</a></code> and <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme()</a></code> models are
identical, while the case-level CV results are very similar but not
identical.</p>
</div>
<div class="section level3">
<h3 id="example-contrived-hierarchical-data">Example: Contrived Hierarchical Data<a class="anchor" aria-label="anchor" href="#example-contrived-hierarchical-data"></a>
</h3>
<p>We introduce an artificial data set that exemplifies aspects of
cross-validation particular to hierarchical models. Using this data set,
we show that model comparisons employing cluster-based and those
employing case-based cross-validation may not agree on a “best” model.
Furthermore, commonly used measures of fit, such as mean-squared error,
do not necessarily become smaller as models become larger, even when the
models are nested, and even when the measure of fit is computed for the
whole data set.</p>
<p>Consider a researcher studying improvement in a skill, yodeling, for
example, among students enrolled in a four-year yodeling program. The
plan is to measure each student’s skill level at the beginning of the
program and every year thereafter until the end of the program,
resulting in five annual measurements for each student. It turns out
that yodeling appeals to students of all ages, and students enrolling in
the program range in age from 20 to 70. Moreover, participants’
untrained yodeling skill is similar at all ages, as is their rate of
progress with training. All students complete the four-year program.</p>
<p>The researcher, who has more expertise in yodeling than in modeling,
decides to model the response, <span class="math inline">\(y\)</span>,
yodeling skill, as a function of age, <span class="math inline">\(x\)</span>, reasoning that students get older
during their stay in the program, and (incorrectly) that age can serve
as a proxy for elapsed time. The researcher knows that a mixed model
should be used to account for clustering due to the expected similarity
of measurements taken from each student.</p>
<p>We start by generating the data, using parameters consistent with the
description above and meant to highlight the issues that arise in
cross-validating mixed-effects models:<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;We invite the interested reader to experiment with
varying the parameters of our example.&lt;/p&gt;"><sup>7</sup></a></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Parameters:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9693</span><span class="op">)</span> </span>
<span><span class="va">Nb</span> <span class="op">&lt;-</span> <span class="fl">100</span>     <span class="co"># number of groups</span></span>
<span><span class="va">Nw</span> <span class="op">&lt;-</span> <span class="fl">5</span>       <span class="co"># number of individuals within groups</span></span>
<span><span class="va">Bb</span> <span class="op">&lt;-</span> <span class="fl">0</span>       <span class="co"># between-group regression coefficient on group mean</span></span>
<span><span class="va">SDre</span> <span class="op">&lt;-</span> <span class="fl">2.0</span>   <span class="co"># between-group SD of random level relative to group mean of x</span></span>
<span><span class="va">SDwithin</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>  <span class="co"># within group SD</span></span>
<span><span class="va">Bw</span> <span class="op">&lt;-</span> <span class="fl">1</span>          <span class="co"># within group effect of x</span></span>
<span><span class="va">Ay</span> <span class="op">&lt;-</span> <span class="fl">10</span>         <span class="co"># intercept for response</span></span>
<span><span class="va">Ax</span> <span class="op">&lt;-</span> <span class="fl">20</span>         <span class="co"># starting level of x</span></span>
<span><span class="va">Nx</span> <span class="op">&lt;-</span> <span class="va">Nw</span><span class="op">*</span><span class="fl">10</span>      <span class="co"># number of distinct x values</span></span>
<span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Nb</span>, each<span class="op">=</span><span class="va">Nw</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="va">Ax</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">Nx</span>, length.out <span class="op">=</span> <span class="va">Nw</span><span class="op">*</span><span class="va">Nb</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span></span>
<span>    <span class="op">{</span></span>
<span>      <span class="va">xm</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ave.html" class="external-link">ave</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">group</span>, FUN <span class="op">=</span> <span class="va">mean</span><span class="op">)</span> <span class="co"># within-group mean</span></span>
<span>      <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">Ay</span> <span class="op">+</span></span>
<span>        <span class="va">Bb</span> <span class="op">*</span> <span class="va">xm</span> <span class="op">+</span>                    <span class="co"># contextual effect</span></span>
<span>        <span class="va">Bw</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">xm</span><span class="op">)</span> <span class="op">+</span>              <span class="co"># within-group effect</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">Nb</span>, sd<span class="op">=</span><span class="va">SDre</span><span class="op">)</span><span class="op">[</span><span class="va">group</span><span class="op">]</span> <span class="op">+</span>  <span class="co"># random level by group</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">Nb</span><span class="op">*</span><span class="va">Nw</span>, sd<span class="op">=</span><span class="va">SDwithin</span><span class="op">)</span>    <span class="co"># random error within groups</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Here is a scatterplot of the data for a representative group of 10
(without loss of generality, the first 10) of 100 students, showing the
95% concentration ellipse for each cluster:<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;We find it convenient to use the
&lt;strong&gt;lattice&lt;/strong&gt; &lt;span class="citation"&gt;(Sarkar, 2008)&lt;/span&gt;
and &lt;strong&gt;latticeExtra&lt;/strong&gt; &lt;span class="citation"&gt;(Sarkar &amp;amp;
Andrews, 2022)&lt;/span&gt; packages for this and other graphs in this
section.&lt;/p&gt;'><sup>8</sup></a></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://lattice.r-forge.r-project.org/" class="external-link">"lattice"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://latticeextra.r-forge.r-project.org/" class="external-link">"latticeExtra"</a></span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">Data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">Nx</span>, <span class="op">]</span>, group<span class="op">=</span><span class="va">group</span>,</span>
<span>               ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">16</span><span class="op">)</span>,</span>
<span>               par.settings<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>superpose.symbol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pch<span class="op">=</span><span class="fl">1</span>, cex<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html" class="external-link">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/panel.ellipse.html" class="external-link">panel.ellipse</a></span><span class="op">(</span><span class="va">...</span>, center.cex<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot</span> <span class="co"># display graph</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/plot1-1.png" alt="Hierarchical data set, showing the first 10 of 100 students." width="100%"><p class="caption">
Hierarchical data set, showing the first 10 of 100 students.
</p>
</div>
<p>The between-student effect of age is 0 but the within-student effect
is 1. Due to the large variation in ages between students, the
least-squares regression of yodeling skill on age (for the 500
observations among all 100 students) produces an estimated slope close
to 0 (though with a small <span class="math inline">\(p\)</span>-value),
because the slope is heavily weighted toward the between-student
effect:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data<span class="op">=</span><span class="va">Data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = y ~ x, data = Data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -5.771 -1.658 -0.089  1.552  7.624 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  9.05043    0.34719   26.07   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; x            0.02091    0.00727    2.87   0.0042 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 2.35 on 498 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.0163, Adjusted R-squared:  0.0143 </span></span>
<span><span class="co">#&gt; F-statistic: 8.26 on 1 and 498 DF,  p-value: 0.00422</span></span></code></pre></div>
<p>The initial mixed-effects model that we fit to the data is a simple
random-intercepts model:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># random intercept only:</span></span>
<span><span class="va">mod.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">group</span><span class="op">)</span>, <span class="va">Data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.0</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: y ~ 1 + (1 | group)</span></span>
<span><span class="co">#&gt;    Data: Data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 2103.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.0351 -0.7264 -0.0117  0.7848  2.0438 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  group    (Intercept) 2.90     1.70    </span></span>
<span><span class="co">#&gt;  Residual             2.71     1.65    </span></span>
<span><span class="co">#&gt; Number of obs: 500, groups:  group, 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)   10.002      0.186    53.9</span></span></code></pre></div>
<p>We will shortly consider three other, more complex, mixed models;
because of data-management considerations, it is convenient to fit them
now, but we defer discussion of these models:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># effect of x and random intercept:</span></span>
<span><span class="va">mod.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">group</span><span class="op">)</span>, <span class="va">Data</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># effect of x, contextual (student) mean of x, and random intercept:</span></span>
<span><span class="va">mod.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">xm</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">group</span><span class="op">)</span>, <span class="va">Data</span><span class="op">)</span></span>
<span>        <span class="co"># equivalent to y ~ I(x - xm) + xm + (1 | group)</span></span>
<span></span>
<span><span class="co"># model generating the data (where Bb = 0)</span></span>
<span><span class="va">mod.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">xm</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">group</span><span class="op">)</span>, <span class="va">Data</span><span class="op">)</span></span></code></pre></div>
<p>We proceed to obtain predictions from the random-intercept model
(<code>mod.0</code>) and the other models (<code>mod.1</code>,
<code>mod.2</code>, and <code>mod.3</code>) based on fixed effects
alone, as would be used for cross-validation based on clusters (i.e.,
students), and for fixed and random effects—so-called best linear
unbiased predictions or BLUPs—as would be used for cross-validation
based on cases (i.e., occasions within students):</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">Data</span>, <span class="op">{</span></span>
<span>  <span class="va">fit_mod0.fe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod.0</span>, re.form <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># fixed effects only</span></span>
<span>  <span class="va">fit_mod0.re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod.0</span><span class="op">)</span> <span class="co"># fixed and random effects (BLUPs)</span></span>
<span>  <span class="va">fit_mod1.fe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod.1</span>, re.form <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">fit_mod1.re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod.1</span><span class="op">)</span></span>
<span>  <span class="va">fit_mod2.fe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod.2</span>, re.form <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">fit_mod2.re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod.2</span><span class="op">)</span></span>
<span>  <span class="va">fit_mod3.fe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod.3</span>, re.form <span class="op">=</span> <span class="op">~</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="va">fit_mod3.re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">mod.3</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We then prepare the data for plotting:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Data_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">Nx</span>, <span class="op">]</span>, direction <span class="op">=</span> <span class="st">"long"</span>, sep <span class="op">=</span> <span class="st">"."</span>, </span>
<span>              timevar <span class="op">=</span> <span class="st">"effect"</span>, varying <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"\\."</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">Nx</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Data_long</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Data_long</span><span class="op">)</span></span>
<span><span class="va">Data_long</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html" class="external-link">reshape</a></span><span class="op">(</span><span class="va">Data_long</span>, direction <span class="op">=</span> <span class="st">"long"</span>, sep <span class="op">=</span> <span class="st">"_"</span>, </span>
<span>              timevar <span class="op">=</span> <span class="st">"modelcode"</span>,  varying <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Data_long</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Data_long</span><span class="op">$</span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~ 1"</span>, <span class="st">"~ 1 + x"</span>, <span class="st">"~ 1 + x + xm"</span>, <span class="st">"~ 1 + I(x - xm)"</span><span class="op">)</span></span>
<span>  <span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">Data_long</span><span class="op">$</span><span class="va">modelcode</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mod0"</span>, <span class="st">"mod1"</span>, <span class="st">"mod2"</span>, <span class="st">"mod3"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Predictions based on the random-intercept model <code>mod.0</code>
for the first 10 students are shown in the following graph:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">~</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Data_long</span>, <span class="va">modelcode</span> <span class="op">==</span> <span class="st">"mod0"</span> <span class="op">&amp;</span> <span class="va">effect</span> <span class="op">==</span> <span class="st">"fe"</span><span class="op">)</span>,</span>
<span>         groups<span class="op">=</span><span class="va">group</span>, type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">~</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Data_long</span>, <span class="va">modelcode</span> <span class="op">==</span> <span class="st">"mod0"</span> <span class="op">&amp;</span>  <span class="va">effect</span> <span class="op">==</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>         groups<span class="op">=</span><span class="va">group</span>, type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>  main<span class="op">=</span><span class="st">"Model: y ~ 1 + (1 | group)"</span>,</span>
<span>  key<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    corner<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fixed effects only"</span>,<span class="st">"fixed and random"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    lines<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/plot-fits-mod0-1.png" alt="Predictions from the random intercept model." width="100%"><p class="caption">
Predictions from the random intercept model.
</p>
</div>
<p>The fixed-effect predictions for the various individuals are
identical—the estimated fixed-effects intercept or estimated general
mean of <span class="math inline">\(y\)</span>—while the BLUPs are the
sums of the fixed-effects intercept and the random intercepts, and are
only slightly shrunken towards the general mean. Because in our
artificial data there is no population relationship between age and
skill, the fixed-effect-only predictions and the BLUPs are not very
different.</p>
<p>Our next model, <code>mod.1</code>, includes a fixed intercept and
fixed effect of <code>x</code> along with a random intercept:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: y ~ x + (1 | group)</span></span>
<span><span class="co">#&gt;    Data: Data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 1564.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.9016 -0.6350  0.0188  0.5541  2.8293 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  group    (Intercept) 192.941  13.890  </span></span>
<span><span class="co">#&gt;  Residual               0.257   0.507  </span></span>
<span><span class="co">#&gt; Number of obs: 500, groups:  group, 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept) -33.9189     1.5645   -21.7</span></span>
<span><span class="co">#&gt; x             0.9653     0.0158    61.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;   (Intr)</span></span>
<span><span class="co">#&gt; x -0.460</span></span></code></pre></div>
<p>Predictions from this model appear in the following graph:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">~</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Data_long</span>, <span class="va">modelcode</span> <span class="op">==</span> <span class="st">"mod1"</span> <span class="op">&amp;</span> <span class="va">effect</span> <span class="op">==</span> <span class="st">"fe"</span><span class="op">)</span>,</span>
<span>         groups<span class="op">=</span><span class="va">group</span>, type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">~</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Data_long</span>, <span class="va">modelcode</span> <span class="op">==</span> <span class="st">"mod1"</span> <span class="op">&amp;</span> <span class="va">effect</span> <span class="op">==</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>         groups<span class="op">=</span><span class="va">group</span>, type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>  main<span class="op">=</span><span class="st">"Model: y ~ 1 + x + (1 | group)"</span>,</span>
<span>  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">15</span>, <span class="fl">35</span><span class="op">)</span>,</span>
<span>  key<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    corner<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fixed effects only"</span>,<span class="st">"fixed and random"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    lines<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/plot-fits-mod1-1.png" alt="Predictions from the model with random intercepts and $x$ as a fixed-effect predictor." width="100%"><p class="caption">
Predictions from the model with random intercepts and <span class="math inline">\(x\)</span> as a fixed-effect predictor.
</p>
</div>
<p>The BLUPs fit the observed data very closely, but predictions based
on the fixed effects alone, with a common intercept and slope for all
clusters, are very poor—indeed, much worse than the fixed-effects-only
predictions based on the simpler random-intercept model,
<code>mod.0</code>. We therefore anticipate (and show later in this
section) that case-based cross-validation will prefer <code>mod1</code>
to <code>mod0</code>, but that cluster-based cross-validation will
prefer <code>mod0</code> to <code>mod1</code>.</p>
<p>Our third model, <code>mod.2</code>, includes the contextual effect
of <span class="math inline">\(x\)</span>—that is, the cluster mean
<code>xm</code>—along with <span class="math inline">\(x\)</span> and
the intercept in the fixed-effect part of the model, and a random
intercept:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: y ~ x + xm + (1 | group)</span></span>
<span><span class="co">#&gt;    Data: Data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 1169.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.9847 -0.6375  0.0019  0.5568  2.7325 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  group    (Intercept) 3.399    1.844   </span></span>
<span><span class="co">#&gt;  Residual             0.255    0.505   </span></span>
<span><span class="co">#&gt; Number of obs: 500, groups:  group, 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)   9.4787     0.6171    15.4</span></span>
<span><span class="co">#&gt; x             0.9915     0.0160    62.1</span></span>
<span><span class="co">#&gt; xm           -0.9800     0.0206   -47.7</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;    (Intr) x     </span></span>
<span><span class="co">#&gt; x   0.000       </span></span>
<span><span class="co">#&gt; xm -0.600 -0.777</span></span></code></pre></div>
<p>This model is equivalent to fitting
<code>y ~ I(x - xm) + xm + (1 | group)</code>, which is the model that
generated the data once the coefficient of the contextual predictor
<code>xm</code> is set to 0 (as it is in <code>mod.3</code>, discussed
below).</p>
<p>Predictions from model <code>mod.2</code> appear in the following
graph:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">~</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Data_long</span>, <span class="va">modelcode</span> <span class="op">==</span> <span class="st">"mod2"</span> <span class="op">&amp;</span> <span class="va">effect</span> <span class="op">==</span> <span class="st">"fe"</span><span class="op">)</span>,</span>
<span>         groups<span class="op">=</span><span class="va">group</span>, type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">~</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Data_long</span>, <span class="va">modelcode</span> <span class="op">==</span> <span class="st">"mod2"</span> <span class="op">&amp;</span> <span class="va">effect</span> <span class="op">==</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>         groups<span class="op">=</span><span class="va">group</span>, type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>  main<span class="op">=</span><span class="st">"Model: y ~ 1 + x + xm + (1 | group)"</span>,</span>
<span>  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">16</span><span class="op">)</span>,</span>
<span>  key<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    corner<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fixed effects only"</span>,<span class="st">"fixed and random"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    lines<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/plot-fits-mod2-1.png" alt="Predictors from the model with random intercepts, $x$, and the group (student) mean of $x$ as predictors." width="100%"><p class="caption">
Predictors from the model with random intercepts, <span class="math inline">\(x\)</span>, and the group (student) mean of <span class="math inline">\(x\)</span> as predictors.
</p>
</div>
<p>Depending on the estimated variance parameters of the model, a mixed
model like <code>mod.2</code> will apply varying degrees of shrinkage to
the random-intercept BLUPs that correspond to variation in the heights
of the parallel fitted lines for the individual students. In our
contrived data, the <code>mod.2</code> applies little shrinkage,
allowing substantial variability in the heights of the fitted lines,
which closely approach the observed values for each student. The fit of
the mixed model <code>mod.2</code> is consequently similar to that of a
fixed-effects model with age and a categorical predictor for individual
students (i.e., treating students as a factor, and not shown here).</p>
<p>The mixed model <code>mod.2</code> therefore fits individual
observations well, and we anticipate a favorable assessment using
individual-based cross-validation. In contrast, the large variability in
the BLUPs results in larger residuals for predictions based on fixed
effects alone, and so we expect that cluster-based cross-validation
won’t show an advantage for model <code>mod.2</code> compared to the
smaller model <code>mod.0</code>, which includes only fixed and random
intercepts.</p>
<p>Had the mixed model applied considerable shrinkage, then neither
cluster-based nor case-based cross-validation would show much
improvement over the random-intercept-only model. In our experience, the
degree of shrinkage does not vary smoothly as parameters are changed but
tends to be “all or nothing,” and near the tipping point, the behavior
of estimates can be affected considerably by the choice of algorithm
used to fit the model.</p>
<p>Finally, <code>mod.3</code> directly estimates the model used to
generate the data. As mentioned, it is a constrained version of
<code>mod.2</code>, with the coefficient of <code>xm</code> set to 0,
and with <code>x</code> expressed as a deviation from the cluster mean
<code>xm</code>:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod.3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear mixed model fit by REML ['lmerMod']</span></span>
<span><span class="co">#&gt; Formula: y ~ I(x - xm) + (1 | group)</span></span>
<span><span class="co">#&gt;    Data: Data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML criterion at convergence: 1163.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Scaled residuals: </span></span>
<span><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">#&gt; -2.9770 -0.6320  0.0063  0.5603  2.7249 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;  Groups   Name        Variance Std.Dev.</span></span>
<span><span class="co">#&gt;  group    (Intercept) 3.391    1.842   </span></span>
<span><span class="co">#&gt;  Residual             0.255    0.505   </span></span>
<span><span class="co">#&gt; Number of obs: 500, groups:  group, 100</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value</span></span>
<span><span class="co">#&gt; (Intercept)   10.002      0.185    53.9</span></span>
<span><span class="co">#&gt; I(x - xm)      0.992      0.016    62.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Correlation of Fixed Effects:</span></span>
<span><span class="co">#&gt;           (Intr)</span></span>
<span><span class="co">#&gt; I(x - xm) 0.000</span></span></code></pre></div>
<p>The predictions from <code>mod.3</code> are therefore similar to
those from <code>mod.2</code>:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">~</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Data_long</span>, <span class="va">modelcode</span> <span class="op">==</span> <span class="st">"mod3"</span> <span class="op">&amp;</span> <span class="va">effect</span> <span class="op">==</span> <span class="st">"fe"</span><span class="op">)</span>,</span>
<span>         groups<span class="op">=</span><span class="va">group</span>, type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">fit</span> <span class="op">~</span> <span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">Data_long</span>, <span class="va">modelcode</span> <span class="op">==</span> <span class="st">"mod3"</span> <span class="op">&amp;</span> <span class="va">effect</span> <span class="op">==</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>         groups<span class="op">=</span><span class="va">group</span>, type<span class="op">=</span><span class="st">"l"</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span></span>
<span>  main<span class="op">=</span><span class="st">"Model: y ~ 1 + I(x - xm) + (1 | group)"</span>,</span>
<span>  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">16</span><span class="op">)</span>,</span>
<span>  key<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    corner<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>    text<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fixed effects only"</span>,<span class="st">"fixed and random"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    lines<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/plot-fits-mod3-1.png" alt="Predictions from the estimated model generating the data." width="100%"><p class="caption">
Predictions from the estimated model generating the data.
</p>
</div>
<p>We next carry out case-based cross-validation, which, as we have
explained, is based on both fixed and predicted random effects (i.e.,
BLUPs), and cluster-based cross-validation, which is based on fixed
effects only. In order to reduce between-model random variability in
comparisons of models, we apply <code><a href="../reference/cv.html">cv()</a></code> to the list of models
created by the <code><a href="../reference/models.html">models()</a></code> function (introduced previously),
performing cross-validation with the same folds for each model:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/models.html">models</a></span><span class="op">(</span><span class="st">"~ 1"</span><span class="op">=</span><span class="va">mod.0</span>, <span class="st">"~ 1 + x"</span><span class="op">=</span><span class="va">mod.1</span>, </span>
<span>                  <span class="st">"~ 1 + x + xm"</span><span class="op">=</span><span class="va">mod.2</span>, <span class="st">"~ 1 + I(x - xm)"</span><span class="op">=</span><span class="va">mod.3</span><span class="op">)</span></span>
<span><span class="va">cvs_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">modlist</span>, data<span class="op">=</span><span class="va">Data</span>, cluster<span class="op">=</span><span class="st">"group"</span>, k<span class="op">=</span><span class="fl">10</span>, seed<span class="op">=</span><span class="fl">6449</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvs_clusters</span>, main<span class="op">=</span><span class="st">"Model Comparison, Cluster-Based CV"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/cross-validation-clusters-1.png" alt="10-fold cluster-based cross-validation comparing random intercept models with varying fixed effects." width="100%"><p class="caption">
10-fold cluster-based cross-validation comparing random intercept models
with varying fixed effects.
</p>
</div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvs_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">modlist</span>, data<span class="op">=</span><span class="va">Data</span>, seed<span class="op">=</span><span class="fl">9693</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cvs_cases</span>, main<span class="op">=</span><span class="st">"Model Comparison, Case-Based CV"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/cross-validation-cases-1.png" alt="10-fold case-based cross-validation comparing random intercept models with varying fixed effects." width="100%"><p class="caption">
10-fold case-based cross-validation comparing random intercept models
with varying fixed effects.
</p>
</div>
<p>In summary, model <code>mod.1</code>, with <span class="math inline">\(x\)</span> alone and without the contextual mean
of <span class="math inline">\(x\)</span>, is assessed as fitting very
poorly by cluster-based CV, but relatively much better by case-based CV.
Model <code>mod.2</code>, which includes both <span class="math inline">\(x\)</span> and its contextual mean, produces
better results using both cluster-based and case-based CV. The
data-generating model, <code>mod.3</code>, which includes the fixed
effect of <code>x - xm</code> in place of separate terms in
<code>x</code> and <code>xm</code>, isn’t distinguishable from model
<code>mod.2</code>, which includes <code>x</code> and <code>xm</code>
separately, even though <code>mod.2</code> has an unnecessary parameter
(recall that the population coefficient of <code>xm</code> is 0 when
<code>x</code> is expressed as deviations from the contextual mean).
These conclusions are consistent with our observations based on graphing
predictions from the various models, and they illustrate the
desirability of assessing mixed-effect models at different hierarchical
levels.</p>
</div>
</div>
<div class="section level2">
<h2 id="replicating-cross-validation">Replicating cross-validation<a class="anchor" aria-label="anchor" href="#replicating-cross-validation"></a>
</h2>
<p>Assuming that the number of cases <span class="math inline">\(n\)</span> is a multiple of the number of folds
<span class="math inline">\(k\)</span>—a slightly simplifying
assumption—the number of possible partitions of cases into folds is
<span class="math inline">\(\frac{n!}{[(n/k)!]^k}\)</span>, a number
that grows very large very quickly. For example, for <span class="math inline">\(n = 10\)</span> and <span class="math inline">\(k
= 5\)</span>, so that the folds are each of size <span class="math inline">\(n/k = 2\)</span>, there are <span class="math inline">\(113,400\)</span> possible partitions; for <span class="math inline">\(n=100\)</span> and <span class="math inline">\(k=5\)</span>, where <span class="math inline">\(n/k = 20\)</span>, still a small problem, the
number of possible partitions is truly astronomical, <span class="math inline">\(1.09\times 10^{66}\)</span>.</p>
<p>Because the partition into folds that’s employed is selected
randomly, the resulting CV criterion estimates are subject to sampling
error. (An exception is LOO cross-validation, which is not at all
random.) To get a sense of the magnitude of the sampling error, we can
repeat the CV procedure with different randomly selected partitions into
folds. All of the CV functions in the <strong>cv</strong> package are
capable of repeated cross-validation, with the number of repetitions
controlled by the <code>reps</code> argument, which defaults to
<code>1</code>.</p>
<p>Here, for example, is 10-fold CV for the Mroz logistic regression,
repeated 5 times:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz</span>, criterion<span class="op">=</span><span class="va">BayesRule</span>, seed<span class="op">=</span><span class="fl">248</span>, reps<span class="op">=</span><span class="fl">5</span>, </span>
<span>   method<span class="op">=</span><span class="st">"Woodbury"</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 248</span></span>
<span><span class="co">#&gt; R RNG seed set to 68134</span></span>
<span><span class="co">#&gt; R RNG seed set to 767359</span></span>
<span><span class="co">#&gt; R RNG seed set to 556270</span></span>
<span><span class="co">#&gt; R RNG seed set to 882966</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Replicate 1:</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.32005</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.31301</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Replicate 2:</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.31607</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.3117</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Replicate 3:</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.31474</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.30862</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Replicate 4:</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.32404</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.31807</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Replicate 5:</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.32404</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.31926</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Average:</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.31983 (0.003887)</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.31394 (0.0040093)</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.30677</span></span></code></pre></div>
<p>When <code>reps</code> &gt; <code>1</code>, the result returned by
<code><a href="../reference/cv.html">cv()</a></code> is an object of class <code>"cvList"</code>—literally
a list of <code>"cv"</code> objects. The results are reported for each
repetition and then averaged across repetitions, with the standard
deviations of the CV criterion and the biased-adjusted CV criterion
given in parentheses. In this example, there is therefore little
variation across repetitions, increasing our confidence in the
reliability of the results.</p>
<p>Notice that the seed that’s set in the <code><a href="../reference/cv.html">cv()</a></code> command
pertains to the first repetition and the seeds for the remaining
repetitions are then selected pseudo-randomly.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Because of the manner in which the computation is
performed, the order of the replicates in the &lt;code&gt;"cvList"&lt;/code&gt;
object returned by &lt;code&gt;&lt;a href="../reference/cv.html"&gt;cv()&lt;/a&gt;&lt;/code&gt; isn’t the same as the order in
which the replicates are computed. Each element of the result, however,
is a &lt;code&gt;"cv"&lt;/code&gt; object with the correct random-number seed saved,
and so this technical detail can be safely ignored. The individual
&lt;code&gt;"cv"&lt;/code&gt; objects are printed in the order in which they are
stored rather than the order in which they are computed.&lt;/p&gt;'><sup>9</sup></a> Setting the first
seed, however, makes the entire process easily replicable, and the seed
for each repetition is stored in the corresponding element of the
<code>"cvList"</code> object (which isn’t, however, saved in the
example).</p>
<p>It’s also possible to replicate CV when comparing competing models
via the <code><a href="../reference/cv.html">cv()</a></code> method for <code>"modList"</code> objects.
Recall our comparison of polynomial regressions of varying degree fit to
the <code>Auto</code> data; we performed 10-fold CV for each of 10
models. Here, we replicate that process 5 times for each model and graph
the results:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv.auto.reps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="fu"><a href="../reference/models.html">models</a></span><span class="op">(</span><span class="va">m.1</span>, <span class="va">m.2</span>, <span class="va">m.3</span>, <span class="va">m.4</span>, <span class="va">m.5</span>,</span>
<span>                        <span class="va">m.6</span>, <span class="va">m.7</span>, <span class="va">m.8</span>, <span class="va">m.9</span>, <span class="va">m.10</span><span class="op">)</span>,</span>
<span>                 data<span class="op">=</span><span class="va">Auto</span>, seed<span class="op">=</span><span class="fl">8004</span>, reps<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cv.auto.reps</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/model-comparison-with-reps-1.png" alt=" Replicated cross-validated 10-fold CV as a function of polynomial degree, $p$" width="100%"><p class="caption">
Replicated cross-validated 10-fold CV as a function of polynomial
degree, <span class="math inline">\(p\)</span>
</p>
</div>
<p>The graph shows both the average CV criterion and its range for each
of the competing models.</p>
</div>
<div class="section level2">
<h2 id="cross-validating-model-selection">Cross-validating model selection<a class="anchor" aria-label="anchor" href="#cross-validating-model-selection"></a>
</h2>
<div class="section level3">
<h3 id="a-preliminary-example">A preliminary example<a class="anchor" aria-label="anchor" href="#a-preliminary-example"></a>
</h3>
<p>As <span class="citation">Hastie, Tibshirani, &amp; Friedman (2009,
sec. 7.10.2: “The Wrong and Right Way to Do Cross-validation”)</span>
explain, if the whole data are used to select or fine-tune a statistical
model, subsequent cross-validation of the model is intrinsically
misleading, because the model is selected to fit the whole data,
including the part of the data that remains when each fold is
removed.</p>
<p>The following example is similar in spirit to one employed by <span class="citation">Hastie et al. (2009)</span>. Suppose that we randomly
generate <span class="math inline">\(n = 1000\)</span> independent
observations for a response variable variable <span class="math inline">\(y \sim N(\mu = 10, \sigma^2 = 0)\)</span>, and
independently sample <span class="math inline">\(1000\)</span>
observations for <span class="math inline">\(p = 100\)</span>
“predictors,” <span class="math inline">\(x_1, \ldots, x_{100}\)</span>,
each from <span class="math inline">\(x_j \sim N(0, 1)\)</span>. The
response has nothing to do with the predictors and so the population
linear-regression model <span class="math inline">\(y_i = \alpha +
\beta_1 x_{i1} + \cdots + \beta_{100} x_{i,100} + \varepsilon_i\)</span>
has <span class="math inline">\(\alpha = 10\)</span> and all <span class="math inline">\(\beta_j = 0\)</span>.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">24361</span><span class="op">)</span> <span class="co"># for reproducibility</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, mean<span class="op">=</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">1000</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">D</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;         y      X.1      X.2      X.3       X.4       X.5</span></span>
<span><span class="co">#&gt; 1 10.0316 -1.23886 -0.26487 -0.03539 -2.576973  0.811048</span></span>
<span><span class="co">#&gt; 2  9.6650  0.12287 -0.17744  0.37290 -0.935138  0.628673</span></span>
<span><span class="co">#&gt; 3 10.0232 -0.95052 -0.73487 -1.05978  0.882944  0.023918</span></span>
<span><span class="co">#&gt; 4  8.9910  1.13571  0.32411  0.11037  1.376303 -0.422114</span></span>
<span><span class="co">#&gt; 5  9.0712  1.49474  1.87538  0.10575  0.292140 -0.184568</span></span>
<span><span class="co">#&gt; 6 11.3493 -0.18453 -0.78037 -1.23804 -0.010949  0.691034</span></span></code></pre></div>
<p>Least-squares provides accurate estimates of the regression constant
<span class="math inline">\(\alpha = 10\)</span> and the error variance
<span class="math inline">\(\sigma^2 = 1\)</span> for the “null model”
including only the regression constant; moreover, the omnibus <span class="math inline">\(F\)</span>-test of the correct null hypothesis
that all of the <span class="math inline">\(\beta\)</span>s are 0 for
the “full model” with all 100 <span class="math inline">\(x\)</span>s is
associated with a large <span class="math inline">\(p\)</span>-value:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data<span class="op">=</span><span class="va">D</span><span class="op">)</span></span>
<span><span class="va">m.null</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span>, data<span class="op">=</span><span class="va">D</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">m.null</span>, <span class="va">m.full</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Variance Table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model 1: y ~ 1</span></span>
<span><span class="co">#&gt; Model 2: y ~ X.1 + X.2 + X.3 + X.4 + X.5 + X.6 + X.7 + X.8 + X.9 + X.10 + </span></span>
<span><span class="co">#&gt;     X.11 + X.12 + X.13 + X.14 + X.15 + X.16 + X.17 + X.18 + X.19 + </span></span>
<span><span class="co">#&gt;     X.20 + X.21 + X.22 + X.23 + X.24 + X.25 + X.26 + X.27 + X.28 + </span></span>
<span><span class="co">#&gt;     X.29 + X.30 + X.31 + X.32 + X.33 + X.34 + X.35 + X.36 + X.37 + </span></span>
<span><span class="co">#&gt;     X.38 + X.39 + X.40 + X.41 + X.42 + X.43 + X.44 + X.45 + X.46 + </span></span>
<span><span class="co">#&gt;     X.47 + X.48 + X.49 + X.50 + X.51 + X.52 + X.53 + X.54 + X.55 + </span></span>
<span><span class="co">#&gt;     X.56 + X.57 + X.58 + X.59 + X.60 + X.61 + X.62 + X.63 + X.64 + </span></span>
<span><span class="co">#&gt;     X.65 + X.66 + X.67 + X.68 + X.69 + X.70 + X.71 + X.72 + X.73 + </span></span>
<span><span class="co">#&gt;     X.74 + X.75 + X.76 + X.77 + X.78 + X.79 + X.80 + X.81 + X.82 + </span></span>
<span><span class="co">#&gt;     X.83 + X.84 + X.85 + X.86 + X.87 + X.88 + X.89 + X.90 + X.91 + </span></span>
<span><span class="co">#&gt;     X.92 + X.93 + X.94 + X.95 + X.96 + X.97 + X.98 + X.99 + X.100</span></span>
<span><span class="co">#&gt;   Res.Df RSS  Df Sum of Sq    F Pr(&gt;F)</span></span>
<span><span class="co">#&gt; 1    999 974                          </span></span>
<span><span class="co">#&gt; 2    899 888 100      85.2 0.86   0.82</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.null</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = y ~ 1, data = D)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -3.458 -0.681  0.019  0.636  2.935 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   9.9370     0.0312     318   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.987 on 999 degrees of freedom</span></span></code></pre></div>
<p>Next, using the <code><a href="https://rdrr.io/pkg/MASS/man/stepAIC.html" class="external-link">stepAIC()</a></code> function in the
<strong>MASS</strong> package <span class="citation">(Venables &amp;
Ripley, 2002)</span>, let us perform a forward stepwise regression to
select a “best” model, starting with the null model, and using AIC as
the model-selection criterion (see the help page for
<code><a href="https://rdrr.io/pkg/MASS/man/stepAIC.html" class="external-link">stepAIC()</a></code> for details):<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;It’s generally advantageous to start with the largest
model, here the one with 100 predictors, and proceed by backward
elimination. In this demonstration, however, where all of the &lt;span class="math inline"&gt;\(\beta\)&lt;/span&gt;s are really 0, the selected model
will be small, and so we proceed by forward selection from the null
model to save computing time.&lt;/p&gt;'><sup>10</sup></a></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.select</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/stepAIC.html" class="external-link">stepAIC</a></span><span class="op">(</span><span class="va">m.null</span>,</span>
<span>                          direction<span class="op">=</span><span class="st">"forward"</span>, trace<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                          scope<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">m.full</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.select</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = y ~ X.99 + X.90 + X.87 + X.40 + X.65 + X.91 + X.53 + </span></span>
<span><span class="co">#&gt;     X.45 + X.31 + X.56 + X.61 + X.60 + X.46 + X.35 + X.92, data = D)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -3.262 -0.645  0.024  0.641  3.118 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)   9.9372     0.0310  320.80   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; X.99         -0.0910     0.0308   -2.95   0.0032 ** </span></span>
<span><span class="co">#&gt; X.90         -0.0820     0.0314   -2.62   0.0090 ** </span></span>
<span><span class="co">#&gt; X.87         -0.0694     0.0311   -2.24   0.0256 *  </span></span>
<span><span class="co">#&gt; X.40         -0.0476     0.0308   -1.55   0.1221    </span></span>
<span><span class="co">#&gt; X.65         -0.0552     0.0315   -1.76   0.0795 .  </span></span>
<span><span class="co">#&gt; X.91          0.0524     0.0308    1.70   0.0894 .  </span></span>
<span><span class="co">#&gt; X.53         -0.0492     0.0305   -1.61   0.1067    </span></span>
<span><span class="co">#&gt; X.45          0.0554     0.0318    1.74   0.0818 .  </span></span>
<span><span class="co">#&gt; X.31          0.0452     0.0311    1.46   0.1457    </span></span>
<span><span class="co">#&gt; X.56          0.0543     0.0327    1.66   0.0972 .  </span></span>
<span><span class="co">#&gt; X.61         -0.0508     0.0317   -1.60   0.1091    </span></span>
<span><span class="co">#&gt; X.60         -0.0513     0.0319   -1.61   0.1083    </span></span>
<span><span class="co">#&gt; X.46          0.0516     0.0327    1.58   0.1153    </span></span>
<span><span class="co">#&gt; X.35          0.0470     0.0315    1.49   0.1358    </span></span>
<span><span class="co">#&gt; X.92          0.0443     0.0310    1.43   0.1533    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.973 on 984 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.0442, Adjusted R-squared:  0.0296 </span></span>
<span><span class="co">#&gt; F-statistic: 3.03 on 15 and 984 DF,  p-value: 8.34e-05</span></span>
<span><span class="fu"><a href="../reference/cost-functions.html">mse</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">m.select</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.93063</span></span></code></pre></div>
<p>The resulting model has 15 predictors, a very modest <span class="math inline">\(R^2 = .044\)</span>, but a small <span class="math inline">\(p\)</span>-value for its omnibus <span class="math inline">\(F\)</span>-test (which, of course, is entirely
spurious because the same data were used to select and test the model).
The MSE for the selected model is smaller than the true error variance
<span class="math inline">\(\sigma^2 = 1\)</span>, as is the estimated
error variance for the selected model, <span class="math inline">\(\widehat{\sigma}^2 = 0.973^2 = 0.947\)</span>.</p>
<p>If we cross-validate the selected model, we also obtain an optimistic
estimate of its predictive power:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.select</span>, seed<span class="op">=</span><span class="fl">2529</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 2529</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: mse</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.95937</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.95785</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.93063</span></span></code></pre></div>
<p>The <code><a href="../reference/cvSelect.html">cvSelect()</a></code> function in the <strong>cv</strong>
package allows us to cross-validate the whole model-selection procedure.
The first argument to <code><a href="../reference/cvSelect.html">cvSelect()</a></code> is a model-selection
function capable of refitting the model with a fold omitted and
returning a CV criterion. The <code><a href="../reference/cvSelect.html">selectStepAIC()</a></code> function,
also in <strong>cv</strong> and based on <code><a href="https://rdrr.io/pkg/MASS/man/stepAIC.html" class="external-link">stepAIC()</a></code>, is
suitable for use with <code><a href="../reference/cvSelect.html">cvSelect()</a></code>:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv.select</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cvSelect.html">cvSelect</a></span><span class="op">(</span><span class="va">selectStepAIC</span>, data<span class="op">=</span><span class="va">D</span>, seed<span class="op">=</span><span class="fl">3791</span>,</span>
<span>                      model<span class="op">=</span><span class="va">m.null</span>, direction<span class="op">=</span><span class="st">"forward"</span>,</span>
<span>                      scope<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lower<span class="op">=</span><span class="op">~</span><span class="fl">1</span>, </span>
<span>                                 upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="va">m.full</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 3791</span></span>
<span><span class="va">cv.select</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; cross-validation criterion = 1.0687</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 1.0612</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.93063</span></span></code></pre></div>
<p>The other arguments to <code><a href="../reference/cvSelect.html">cvSelect()</a></code> are:</p>
<ul>
<li>
<code>data</code>, the data set to which the model is fit;</li>
<li>
<code>seed</code>, an optional seed for R’s pseudo-random-number
generator; as for <code><a href="../reference/cv.html">cv()</a></code>, if the seed isn’t supplied by the
user, a seed is randomly selected and saved;</li>
<li>additional arguments required by the model-selection function, here
the starting <code>model</code> argument, the <code>direction</code> of
model selection, and the <code>scope</code> of models considered (from
the model with only a regression constant to the model with all 100
predictors).</li>
</ul>
<p>By default, <code><a href="../reference/cvSelect.html">cvSelect()</a></code> performs 10-fold CV, and produces
an estimate of MSE for the model-selection procedure even
<em>larger</em> than the true error variance, <span class="math inline">\(\sigma^2 = 1\)</span>.</p>
<p>Also by default, when the number of folds is 10 or fewer,
<code><a href="../reference/cvSelect.html">cvSelect()</a></code> saves the coefficients of the selected models.
In this example, the <code><a href="../reference/cvSelect.html">compareFolds()</a></code> function reveals that
the variables retained by the model-selection process in the several
folds are quite different:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cvSelect.html">compareFolds</a></span><span class="op">(</span><span class="va">cv.select</span><span class="op">)</span></span>
<span><span class="co">#&gt;         (Intercept)    X.87    X.90    X.99    X.91    X.54    X.53    X.56</span></span>
<span><span class="co">#&gt; Fold 1       9.9187 -0.0615 -0.0994 -0.0942  0.0512  0.0516                </span></span>
<span><span class="co">#&gt; Fold 2       9.9451 -0.0745 -0.0899 -0.0614          0.0587          0.0673</span></span>
<span><span class="co">#&gt; Fold 3       9.9423 -0.0783 -0.0718 -0.0987  0.0601                  0.0512</span></span>
<span><span class="co">#&gt; Fold 4       9.9410 -0.0860 -0.0831 -0.0867  0.0570         -0.0508        </span></span>
<span><span class="co">#&gt; Fold 5       9.9421 -0.0659 -0.0849 -0.1004  0.0701  0.0511 -0.0487  0.0537</span></span>
<span><span class="co">#&gt; Fold 6       9.9633 -0.0733 -0.0874 -0.0960  0.0555  0.0629 -0.0478        </span></span>
<span><span class="co">#&gt; Fold 7       9.9279 -0.0618 -0.0960 -0.0838  0.0533         -0.0464        </span></span>
<span><span class="co">#&gt; Fold 8       9.9453 -0.0610 -0.0811 -0.0818          0.0497 -0.0612  0.0560</span></span>
<span><span class="co">#&gt; Fold 9       9.9173 -0.0663 -0.0894 -0.1100  0.0504  0.0524          0.0747</span></span>
<span><span class="co">#&gt; Fold 10      9.9449 -0.0745 -0.0906 -0.0891  0.0535  0.0482 -0.0583  0.0642</span></span>
<span><span class="co">#&gt;            X.40    X.45    X.65    X.68    X.92    X.15    X.26    X.46    X.60</span></span>
<span><span class="co">#&gt; Fold 1                  -0.0590                 -0.0456  0.0658  0.0608        </span></span>
<span><span class="co">#&gt; Fold 2                                   0.0607          0.0487                </span></span>
<span><span class="co">#&gt; Fold 3  -0.0496         -0.0664          0.0494                                </span></span>
<span><span class="co">#&gt; Fold 4  -0.0597  0.0579 -0.0531          0.0519 -0.0566                 -0.0519</span></span>
<span><span class="co">#&gt; Fold 5                           0.0587                          0.0527 -0.0603</span></span>
<span><span class="co">#&gt; Fold 6  -0.0596  0.0552          0.0474                                        </span></span>
<span><span class="co">#&gt; Fold 7           0.0572          0.0595                                        </span></span>
<span><span class="co">#&gt; Fold 8           0.0547 -0.0617  0.0453  0.0493 -0.0613  0.0591  0.0703 -0.0588</span></span>
<span><span class="co">#&gt; Fold 9  -0.0552  0.0573 -0.0635  0.0492         -0.0513  0.0484         -0.0507</span></span>
<span><span class="co">#&gt; Fold 10 -0.0558                          0.0529                  0.0710        </span></span>
<span><span class="co">#&gt;            X.61     X.8    X.28    X.29    X.31    X.35    X.70    X.89    X.17</span></span>
<span><span class="co">#&gt; Fold 1  -0.0490          0.0616 -0.0537                  0.0638                </span></span>
<span><span class="co">#&gt; Fold 2           0.0671                  0.0568                  0.0523        </span></span>
<span><span class="co">#&gt; Fold 3  -0.0631          0.0616                                                </span></span>
<span><span class="co">#&gt; Fold 4           0.0659         -0.0549          0.0527                  0.0527</span></span>
<span><span class="co">#&gt; Fold 5           0.0425                  0.0672  0.0613          0.0493        </span></span>
<span><span class="co">#&gt; Fold 6           0.0559         -0.0629  0.0498          0.0487                </span></span>
<span><span class="co">#&gt; Fold 7                                                           0.0611  0.0472</span></span>
<span><span class="co">#&gt; Fold 8  -0.0719                                          0.0586                </span></span>
<span><span class="co">#&gt; Fold 9                   0.0525                                                </span></span>
<span><span class="co">#&gt; Fold 10 -0.0580                                  0.0603                        </span></span>
<span><span class="co">#&gt;            X.25     X.4    X.64    X.81    X.97    X.11     X.2    X.33    X.47</span></span>
<span><span class="co">#&gt; Fold 1                                   0.0604          0.0575                </span></span>
<span><span class="co">#&gt; Fold 2   0.0478          0.0532  0.0518                                        </span></span>
<span><span class="co">#&gt; Fold 3                           0.0574                          0.0473        </span></span>
<span><span class="co">#&gt; Fold 4                   0.0628                                                </span></span>
<span><span class="co">#&gt; Fold 5   0.0518                                                                </span></span>
<span><span class="co">#&gt; Fold 6                                           0.0521                        </span></span>
<span><span class="co">#&gt; Fold 7           0.0550                                                        </span></span>
<span><span class="co">#&gt; Fold 8                                                                         </span></span>
<span><span class="co">#&gt; Fold 9                                   0.0556                          0.0447</span></span>
<span><span class="co">#&gt; Fold 10          0.0516                                                        </span></span>
<span><span class="co">#&gt;             X.6    X.72    X.73    X.77    X.79 X.88</span></span>
<span><span class="co">#&gt; Fold 1   0.0476                                     </span></span>
<span><span class="co">#&gt; Fold 2                   0.0514                     </span></span>
<span><span class="co">#&gt; Fold 3                                              </span></span>
<span><span class="co">#&gt; Fold 4                                  -0.0473     </span></span>
<span><span class="co">#&gt; Fold 5           0.0586                         0.07</span></span>
<span><span class="co">#&gt; Fold 6                          -0.0489             </span></span>
<span><span class="co">#&gt; Fold 7                                              </span></span>
<span><span class="co">#&gt; Fold 8                                              </span></span>
<span><span class="co">#&gt; Fold 9                                              </span></span>
<span><span class="co">#&gt; Fold 10</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="mrozs-logistic-regression-revisited">Mroz’s logistic regression revisited<a class="anchor" aria-label="anchor" href="#mrozs-logistic-regression-revisited"></a>
</h3>
<p>For a contrasting example we apply model selection to Mroz’s logistic
regression for married women’s labor-force participation. First, recall
the logistic regression model that we fit to the <code>Mroz</code>
data:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.mroz</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = lfp ~ ., family = binomial, data = Mroz)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  3.18214    0.64438    4.94  7.9e-07 ***</span></span>
<span><span class="co">#&gt; k5          -1.46291    0.19700   -7.43  1.1e-13 ***</span></span>
<span><span class="co">#&gt; k618        -0.06457    0.06800   -0.95  0.34234    </span></span>
<span><span class="co">#&gt; age         -0.06287    0.01278   -4.92  8.7e-07 ***</span></span>
<span><span class="co">#&gt; wcyes        0.80727    0.22998    3.51  0.00045 ***</span></span>
<span><span class="co">#&gt; hcyes        0.11173    0.20604    0.54  0.58762    </span></span>
<span><span class="co">#&gt; lwg          0.60469    0.15082    4.01  6.1e-05 ***</span></span>
<span><span class="co">#&gt; inc         -0.03445    0.00821   -4.20  2.7e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1029.75  on 752  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:  905.27  on 745  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 921.3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 4</span></span></code></pre></div>
<p>Applying stepwise model selection Mroz’s logistic regression, using
BIC as the model-selection criterion (via the argument
<code>k=log(nrow(Mroz))</code> to <code><a href="https://rdrr.io/pkg/MASS/man/stepAIC.html" class="external-link">stepAIC()</a></code>) selects 5 of
the 7 original predictors:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.mroz.sel</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/stepAIC.html" class="external-link">stepAIC</a></span><span class="op">(</span><span class="va">m.mroz</span>, k<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Mroz</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            trace<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.mroz.sel</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = lfp ~ k5 + age + wc + lwg + inc, family = binomial, </span></span>
<span><span class="co">#&gt;     data = Mroz)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)   2.9019     0.5429    5.35  9.0e-08 ***</span></span>
<span><span class="co">#&gt; k5           -1.4318     0.1932   -7.41  1.3e-13 ***</span></span>
<span><span class="co">#&gt; age          -0.0585     0.0114   -5.13  2.9e-07 ***</span></span>
<span><span class="co">#&gt; wcyes         0.8724     0.2064    4.23  2.4e-05 ***</span></span>
<span><span class="co">#&gt; lwg           0.6157     0.1501    4.10  4.1e-05 ***</span></span>
<span><span class="co">#&gt; inc          -0.0337     0.0078   -4.32  1.6e-05 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 1029.75  on 752  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance:  906.46  on 747  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 918.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 3</span></span>
<span><span class="fu"><a href="../reference/cost-functions.html">BayesRule</a></span><span class="op">(</span><span class="va">Mroz</span><span class="op">$</span><span class="va">lfp</span> <span class="op">==</span> <span class="st">"yes"</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m.mroz.sel</span>, type<span class="op">=</span><span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.31873</span></span></code></pre></div>
<p>The Bayes rule applied to the selected model misclassifies 32% of the
cases in the <code>Mroz</code> data.</p>
<p>Cross-validating the selected model produces a similar, slightly
larger, estimate of misclassification, about 33%:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.mroz.sel</span>, criterion<span class="op">=</span><span class="va">BayesRule</span>, seed<span class="op">=</span><span class="fl">345266</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 345266</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: exact</span></span>
<span><span class="co">#&gt; criterion: BayesRule</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.33068</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.33332</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.31873</span></span></code></pre></div>
<p>Is this estimate of predictive performance optimistic?</p>
<p>We proceed to apply the model-selection procedure by
cross-validation, producing more or less the same result:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.mroz.sel.cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cvSelect.html">cvSelect</a></span><span class="op">(</span><span class="va">selectStepAIC</span>, <span class="va">Mroz</span>, </span>
<span>                          seed<span class="op">=</span><span class="fl">6681</span>,</span>
<span>                          criterion<span class="op">=</span><span class="va">BayesRule</span>,</span>
<span>                          model<span class="op">=</span><span class="va">m.mroz</span>,</span>
<span>                          AIC<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 6681</span></span>
<span><span class="va">m.mroz.sel.cv</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; cross-validation criterion = 0.33068</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 0.33452</span></span>
<span><span class="co">#&gt; full-sample criterion = 0.31873</span></span></code></pre></div>
<p>Setting <code>AIC=FALSE</code> in the call to <code><a href="../reference/cvSelect.html">cvSelect()</a></code>
uses the BIC rather than the AIC as the model-selection criterion. As it
turns out, exactly the same predictors are selected when each of the 10
folds are omitted, and the several coefficient estimates are very
similar, as we show using <code><a href="../reference/cvSelect.html">compareFolds()</a></code>:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cvSelect.html">compareFolds</a></span><span class="op">(</span><span class="va">m.mroz.sel.cv</span><span class="op">)</span></span>
<span><span class="co">#&gt;         (Intercept)     age     inc      k5     lwg wcyes</span></span>
<span><span class="co">#&gt; Fold 1       2.5014 -0.0454 -0.0388 -1.3613  0.5653  0.85</span></span>
<span><span class="co">#&gt; Fold 2       3.0789 -0.0659 -0.0306 -1.5335  0.6923  0.79</span></span>
<span><span class="co">#&gt; Fold 3       3.0141 -0.0595 -0.0305 -1.3994  0.5428  0.86</span></span>
<span><span class="co">#&gt; Fold 4       2.7251 -0.0543 -0.0354 -1.4474  0.6298  1.09</span></span>
<span><span class="co">#&gt; Fold 5       2.7617 -0.0566 -0.0320 -1.4752  0.6324  0.74</span></span>
<span><span class="co">#&gt; Fold 6       3.0234 -0.0621 -0.0348 -1.4537  0.6618  0.94</span></span>
<span><span class="co">#&gt; Fold 7       2.9615 -0.0600 -0.0351 -1.4127  0.5835  0.97</span></span>
<span><span class="co">#&gt; Fold 8       2.9598 -0.0603 -0.0329 -1.3865  0.6210  0.69</span></span>
<span><span class="co">#&gt; Fold 9       3.2481 -0.0650 -0.0381 -1.4138  0.6093  0.94</span></span>
<span><span class="co">#&gt; Fold 10      2.7724 -0.0569 -0.0295 -1.4503  0.6347  0.85</span></span></code></pre></div>
<p>In this example, therefore, we appear to obtain a realistic estimate
of model performance directly from the selected model, because there is
little added uncertainty induced by model selection.</p>
</div>
<div class="section level3">
<h3 id="cross-validating-choice-of-transformations-in-regression">Cross-validating choice of transformations in regression<a class="anchor" aria-label="anchor" href="#cross-validating-choice-of-transformations-in-regression"></a>
</h3>
<p>The <strong>cv</strong> package also provides a
<code><a href="../reference/cvSelect.html">cvSelect()</a></code> procedure, <code><a href="../reference/cvSelect.html">selectTrans()</a></code>, for
choosing transformations of the predictors and the response in
regression.</p>
<p>Some background: As <span class="citation">Weisberg (2014, sec.
8.2)</span> explains, there are technical advantages to having (numeric)
predictors in linear regression analysis that are themselves linearly
related. If the predictors <em>aren’t</em> linearly related, then the
relationships between them can often be straightened by power
transformations. Transformations can be selected after graphical
examination of the data, or by analytic methods. Once the relationships
between the predictors are linearized, it can be advantageous similarly
to transform the response variable towards normality.</p>
<p>Selecting transformations analytically raises the possibility of
automating the process, as would be required for cross-validation. One
could, in principle, apply graphical methods to select transformations
for each fold, but because a data analyst couldn’t forget the choices
made for previous folds, the process wouldn’t really be applied
independently to the folds.</p>
<p>To illustrate, we adapt an example appearing in several places in
<span class="citation">Fox &amp; Weisberg (2019)</span> (for example in
Chapter 3 on transforming data), using data on the prestige and other
characteristics of 102 Canadian occupations circa 1970. The data are in
the <code>Prestige</code> data frame in the <strong>carData</strong>
package:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Prestige"</span>, package<span class="op">=</span><span class="st">"carData"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     education income women prestige census type</span></span>
<span><span class="co">#&gt; gov.administrators      13.11  12351 11.16     68.8   1113 prof</span></span>
<span><span class="co">#&gt; general.managers        12.26  25879  4.02     69.1   1130 prof</span></span>
<span><span class="co">#&gt; accountants             12.77   9271 15.70     63.4   1171 prof</span></span>
<span><span class="co">#&gt; purchasing.officers     11.42   8865  9.11     56.8   1175 prof</span></span>
<span><span class="co">#&gt; chemists                14.62   8403 11.68     73.5   2111 prof</span></span>
<span><span class="co">#&gt; physicists              15.64  11030  5.13     77.6   2113 prof</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="co">#&gt;    education         income          women          prestige        census    </span></span>
<span><span class="co">#&gt;  Min.   : 6.38   Min.   :  611   Min.   : 0.00   Min.   :14.8   Min.   :1113  </span></span>
<span><span class="co">#&gt;  1st Qu.: 8.45   1st Qu.: 4106   1st Qu.: 3.59   1st Qu.:35.2   1st Qu.:3120  </span></span>
<span><span class="co">#&gt;  Median :10.54   Median : 5930   Median :13.60   Median :43.6   Median :5135  </span></span>
<span><span class="co">#&gt;  Mean   :10.74   Mean   : 6798   Mean   :28.98   Mean   :46.8   Mean   :5402  </span></span>
<span><span class="co">#&gt;  3rd Qu.:12.65   3rd Qu.: 8187   3rd Qu.:52.20   3rd Qu.:59.3   3rd Qu.:8312  </span></span>
<span><span class="co">#&gt;  Max.   :15.97   Max.   :25879   Max.   :97.51   Max.   :87.2   Max.   :9517  </span></span>
<span><span class="co">#&gt;    type   </span></span>
<span><span class="co">#&gt;  bc  :44  </span></span>
<span><span class="co">#&gt;  prof:31  </span></span>
<span><span class="co">#&gt;  wc  :23  </span></span>
<span><span class="co">#&gt;  NA's: 4  </span></span>
<span><span class="co">#&gt;           </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>The variables in the <code>Prestige</code> data set are:</p>
<ul>
<li>
<code>education</code>: average years of education for incumbents in
the occupation, from the 1971 Canadian Census.</li>
<li>
<code>income</code>: average dollars of annual income for the
occupation, from the Census.</li>
<li>
<code>women</code>: percentage of occupational incumbents who were
women, also from the Census.</li>
<li>
<code>prestige</code>: the average prestige rating of the occupation
on a 0–100 “thermometer” scale, in a Canadian social survey conducted
around the same time.</li>
<li>
<code>type</code>, type of occupation, and <code>census</code>, the
Census occupational code, which are not used in our example.</li>
</ul>
<p>The object of a regression analysis for the <code>Prestige</code>
data (and their original purpose) is to predict occupational prestige
from the other variables in the data set.</p>
<p>A scatterplot matrix (using the <code><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html" class="external-link">scatterplotMatrix()</a></code>
function in the <strong>car</strong> package) of the numeric variables
in the data reveals that the distributions of <code>income</code> and
<code>women</code> are positively skewed, and that some of the
relationships among the three predictors, and between the predictors and
the response (i.e., <code>prestige</code>), are nonlinear:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://r-forge.r-project.org/projects/car/" class="external-link">"car"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: carData</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'car'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     recode</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html" class="external-link">scatterplotMatrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">prestige</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>                  data<span class="op">=</span><span class="va">Prestige</span>, smooth<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spread<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/scatterplot-matrix-1.png" alt="Scatterplot matrix for the `Prestige` data." width="100%"><p class="caption">
Scatterplot matrix for the <code>Prestige</code> data.
</p>
</div>
<p>The <code><a href="https://rdrr.io/pkg/car/man/powerTransform.html" class="external-link">powerTransform()</a></code> function in the
<strong>car</strong> package transforms variables towards multivariate
normality by a generalization of Box and Cox’s maximum-likelihood-like
approach <span class="citation">(Box &amp; Cox, 1964)</span>. Several
“families” of power transformations can be used, including the original
Box-Cox family, simple powers (and roots), and two adaptations of the
Box-Cox family to data that may include negative values and zeros: the
Box-Cox-with-negatives family and the Yeo-Johnson family; see <span class="citation">Weisberg (2014, Chapter 8)</span>, and <span class="citation">Fox &amp; Weisberg (2019, Chapter 3)</span> for
details. Because <code>women</code> has some zero values, we use the
Yeo-Johnson family:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/powerTransform.html" class="external-link">powerTransform</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">income</span>, <span class="va">education</span>, <span class="va">women</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                         data<span class="op">=</span><span class="va">Prestige</span>, family<span class="op">=</span><span class="st">"yjPower"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">trans</span><span class="op">)</span></span>
<span><span class="co">#&gt; yjPower Transformations to Multinormality </span></span>
<span><span class="co">#&gt;           Est Power Rounded Pwr Wald Lwr Bnd Wald Upr Bnd</span></span>
<span><span class="co">#&gt; income       0.2678        0.33       0.1051       0.4304</span></span>
<span><span class="co">#&gt; education    0.5162        1.00      -0.2822       1.3145</span></span>
<span><span class="co">#&gt; women        0.1630        0.16       0.0112       0.3149</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Likelihood ratio test that all transformation parameters are equal to 0</span></span>
<span><span class="co">#&gt;                              LRT df    pval</span></span>
<span><span class="co">#&gt; LR test, lambda = (0 0 0) 15.739  3 0.00128</span></span></code></pre></div>
<p>We thus have evidence of the desirability of transforming
<code>income</code> (by the <span class="math inline">\(1/3\)</span>
power) and <code>women</code> (by the <span class="math inline">\(0.16\)</span> power—which is close to the “0”
power, i.e., the log transformation), but not <code>education</code>.
Applying the “rounded” power transformations makes the predictors
better-behaved:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">P</span> <span class="op">&lt;-</span> <span class="va">Prestige</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"prestige"</span>, <span class="st">"income"</span>, <span class="st">"education"</span>, <span class="st">"women"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">(</span><span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="va">trans</span><span class="op">$</span><span class="va">roundlam</span><span class="op">)</span></span>
<span><span class="co">#&gt;    income education     women </span></span>
<span><span class="co">#&gt;   0.33000   1.00000   0.16302</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">lambdas</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"education"</span>, <span class="st">"women"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"education"</span>, <span class="st">"women"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">P</span><span class="op">[</span>, <span class="va">var</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/car/man/bcPower.html" class="external-link">yjPower</a></span><span class="op">(</span><span class="va">P</span><span class="op">[</span>, <span class="va">var</span><span class="op">]</span>, lambda<span class="op">=</span><span class="va">lambdas</span><span class="op">[</span><span class="va">var</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="co">#&gt;     prestige        income       education         women     </span></span>
<span><span class="co">#&gt;  Min.   :14.8   Min.   :22.2   Min.   : 6.38   Min.   :0.00  </span></span>
<span><span class="co">#&gt;  1st Qu.:35.2   1st Qu.:44.2   1st Qu.: 8.45   1st Qu.:1.73  </span></span>
<span><span class="co">#&gt;  Median :43.6   Median :50.3   Median :10.54   Median :3.36  </span></span>
<span><span class="co">#&gt;  Mean   :46.8   Mean   :50.8   Mean   :10.74   Mean   :3.50  </span></span>
<span><span class="co">#&gt;  3rd Qu.:59.3   3rd Qu.:56.2   3rd Qu.:12.65   3rd Qu.:5.59  </span></span>
<span><span class="co">#&gt;  Max.   :87.2   Max.   :83.6   Max.   :15.97   Max.   :6.83</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/scatterplotMatrix.html" class="external-link">scatterplotMatrix</a></span><span class="op">(</span><span class="op">~</span> <span class="va">prestige</span> <span class="op">+</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span>,</span>
<span>                  data<span class="op">=</span><span class="va">P</span>, smooth<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spread<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/transformed-predictors-1.png" alt="Scatterplot matrix for the `Prestige` data with the predictors transformed." width="100%"><p class="caption">
Scatterplot matrix for the <code>Prestige</code> data with the
predictors transformed.
</p>
</div>
<p>Comparing the MSE for the regressions with the original and
transformed predictors shows a advantage to the latter:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m.pres</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span>, data<span class="op">=</span><span class="va">Prestige</span><span class="op">)</span></span>
<span><span class="va">m.pres.trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">prestige</span> <span class="op">~</span> <span class="va">income</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">women</span>, data<span class="op">=</span><span class="va">P</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cost-functions.html">mse</a></span><span class="op">(</span><span class="va">Prestige</span><span class="op">$</span><span class="va">prestige</span>, <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">m.pres</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 59.153</span></span>
<span><span class="fu"><a href="../reference/cost-functions.html">mse</a></span><span class="op">(</span><span class="va">P</span><span class="op">$</span><span class="va">prestige</span>, <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">m.pres.trans</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 50.6</span></span></code></pre></div>
<p>Similarly, component+residual plots for the two regressions, produced
by the <code><a href="https://rdrr.io/pkg/car/man/crPlots.html" class="external-link">crPlots()</a></code> function in the <strong>car</strong>
package, suggest that the partial relationship of <code>prestige</code>
to <code>income</code> is more nearly linear in the transformed data,
but the transformation of <code>women</code> fails to capture what
appears to be a slight quadratic partial relationship; the partial
relationship of <code>prestige</code> to <code>education</code> is close
to linear in both regressions:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/crPlots.html" class="external-link">crPlots</a></span><span class="op">(</span><span class="va">m.pres</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/CR-plots-untransformed-1.png" alt="Component+residual plots for the `Prestige` regression with the original predictors." width="672"><p class="caption">
Component+residual plots for the <code>Prestige</code> regression with
the original predictors.
</p>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/car/man/crPlots.html" class="external-link">crPlots</a></span><span class="op">(</span><span class="va">m.pres.trans</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="fig/CR-plots-transformed-1.png" alt="Component+residual plots for the `Prestige` regression with transformed predictors." width="672"><p class="caption">
Component+residual plots for the <code>Prestige</code> regression with
transformed predictors.
</p>
</div>
<p>Having transformed the predictors towards multinormality, we now
consider whether there’s evidence for transforming the response (using
<code><a href="https://rdrr.io/pkg/car/man/powerTransform.html" class="external-link">powerTransform()</a></code> for Box and Cox’s original method), and we
discover that there’s not:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/powerTransform.html" class="external-link">powerTransform</a></span><span class="op">(</span><span class="va">m.pres.trans</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; bcPower Transformation to Normality </span></span>
<span><span class="co">#&gt;    Est Power Rounded Pwr Wald Lwr Bnd Wald Upr Bnd</span></span>
<span><span class="co">#&gt; Y1    1.0194           1       0.6773       1.3615</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test that transformation parameter is equal to 0</span></span>
<span><span class="co">#&gt;  (log transformation)</span></span>
<span><span class="co">#&gt;                          LRT df     pval</span></span>
<span><span class="co">#&gt; LR test, lambda = (0) 32.217  1 1.38e-08</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Likelihood ratio test that no transformation is needed</span></span>
<span><span class="co">#&gt;                            LRT df  pval</span></span>
<span><span class="co">#&gt; LR test, lambda = (1) 0.012384  1 0.911</span></span></code></pre></div>
<p>The <code><a href="../reference/cvSelect.html">selectTrans()</a></code> function in the <strong>cv</strong>
package automates the process of selecting predictor and response
transformations. The function takes a <code>data</code> set and
“working” <code>model</code> as arguments, along with the candidate
<code>predictors</code> and <code>response</code> for transformation,
and the transformation <code>family</code> to employ. If the
<code>predictors</code> argument is missing then only the response is
transformed, and if the <code>response</code> argument is missing, only
the supplied predictors are transformed. The default <code>family</code>
for transforming the predictors is <code>"bcPower"</code>—the original
Box-Cox family—as is the default <code>family.y</code> for transforming
the response; here we specify <code>family="yjPower</code> because of
the zeros in <code>women</code>. <code><a href="../reference/cvSelect.html">selectTrans()</a></code> returns the
result of applying a lack-of-fit criterion to the model after the
selected transformation is applied, with the default
<code>criterion=mse</code>:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cvSelect.html">selectTrans</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">Prestige</span>, model<span class="op">=</span><span class="va">m.pres</span>,</span>
<span>            predictors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"education"</span>, <span class="st">"women"</span><span class="op">)</span>,</span>
<span>            response<span class="op">=</span><span class="st">"prestige"</span>, family<span class="op">=</span><span class="st">"yjPower"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 50.6</span></span></code></pre></div>
<p><code><a href="../reference/cvSelect.html">selectTrans()</a></code> also takes an optional
<code>indices</code> argument, making it suitable for doing computations
on a subset of the data (i.e., a CV fold), and hence for use with
<code><a href="../reference/cvSelect.html">cvSelect()</a></code> (see <code><a href="../reference/cvSelect.html">?selectTrans</a></code> for details):</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cvs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cvSelect.html">cvSelect</a></span><span class="op">(</span><span class="va">selectTrans</span>, data<span class="op">=</span><span class="va">Prestige</span>, model<span class="op">=</span><span class="va">m.pres</span>, seed<span class="op">=</span><span class="fl">1463</span>,</span>
<span>                predictors<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"income"</span>, <span class="st">"education"</span>, <span class="st">"women"</span><span class="op">)</span>,</span>
<span>                response<span class="op">=</span><span class="st">"prestige"</span>,</span>
<span>                family<span class="op">=</span><span class="st">"yjPower"</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 1463</span></span>
<span><span class="va">cvs</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; cross-validation criterion = 54.487</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 54.308</span></span>
<span><span class="co">#&gt; full-sample criterion = 50.6</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cv.html">cv</a></span><span class="op">(</span><span class="va">m.pres</span>, seed<span class="op">=</span><span class="fl">1463</span><span class="op">)</span> <span class="co"># untransformed model with same folds</span></span>
<span><span class="co">#&gt; R RNG seed set to 1463</span></span>
<span><span class="co">#&gt; 10-Fold Cross Validation</span></span>
<span><span class="co">#&gt; method: Woodbury</span></span>
<span><span class="co">#&gt; criterion: mse</span></span>
<span><span class="co">#&gt; cross-validation criterion = 63.293</span></span>
<span><span class="co">#&gt; bias-adjusted cross-validation criterion = 63.073</span></span>
<span><span class="co">#&gt; full-sample criterion = 59.153</span></span>
<span></span>
<span><span class="fu"><a href="../reference/cvSelect.html">compareFolds</a></span><span class="op">(</span><span class="va">cvs</span><span class="op">)</span></span>
<span><span class="co">#&gt;         lam.education lam.income lam.women lamda.y</span></span>
<span><span class="co">#&gt; Fold 1          1.000      0.330     0.330       1</span></span>
<span><span class="co">#&gt; Fold 2          1.000      0.330     0.169       1</span></span>
<span><span class="co">#&gt; Fold 3          1.000      0.330     0.330       1</span></span>
<span><span class="co">#&gt; Fold 4          1.000      0.330     0.330       1</span></span>
<span><span class="co">#&gt; Fold 5          1.000      0.330     0.000       1</span></span>
<span><span class="co">#&gt; Fold 6          1.000      0.330     0.330       1</span></span>
<span><span class="co">#&gt; Fold 7          1.000      0.330     0.330       1</span></span>
<span><span class="co">#&gt; Fold 8          1.000      0.330     0.000       1</span></span>
<span><span class="co">#&gt; Fold 9          1.000      0.330     0.000       1</span></span>
<span><span class="co">#&gt; Fold 10         1.000      0.330     0.000       1</span></span></code></pre></div>
<p>The results suggest that the predictive power of the transformed
regression is reliably greater than that of the untransformed regression
(though in both case, the cross-validated MSE is considerably higher
than the MSE computed for the whole data). Examining the selected
transformations for each fold reveals that the predictor
<code>education</code> and the response <code>prestige</code> are never
transformed; that the <span class="math inline">\(1/3\)</span> power is
selected for <code>income</code> in all of the folds; and that the
transformation selected for <code>women</code> varies narrowly across
the folds between the <span class="math inline">\(0\)</span>th power
(i.e., log) and the <span class="math inline">\(1/3\)</span> power.</p>
</div>
</div>
<div class="section level2">
<h2 id="parallel-computations">Parallel computations<a class="anchor" aria-label="anchor" href="#parallel-computations"></a>
</h2>
<p>The CV functions in the <strong>cv</strong> package are all capable
of performing parallel computations by setting the <code>ncores</code>
argument (specifying the number of computer cores to be used) to a
number &gt; <code>1</code> (which is the default). Parallel computation
can be advantageous for large problems, reducing the execution time of
the program.</p>
<p>To illustrate, let’s time model selection in Mroz’s logistic
regression, repeating the computation as performed previously and then
doing it in parallel using 2 cores:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">m.mroz.sel.cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cvSelect.html">cvSelect</a></span><span class="op">(</span><span class="va">selectStepAIC</span>, <span class="va">Mroz</span>,</span>
<span>                          seed<span class="op">=</span><span class="fl">6681</span>,</span>
<span>                          criterion<span class="op">=</span><span class="va">BayesRule</span>,</span>
<span>                          model<span class="op">=</span><span class="va">m.mroz</span>,</span>
<span>                          AIC<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 6681</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.447   0.000   0.447</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">m.mroz.sel.cv.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cvSelect.html">cvSelect</a></span><span class="op">(</span><span class="va">selectStepAIC</span>, <span class="va">Mroz</span>,</span>
<span>                          seed<span class="op">=</span><span class="fl">6681</span>,</span>
<span>                          criterion<span class="op">=</span><span class="va">BayesRule</span>,</span>
<span>                          model<span class="op">=</span><span class="va">m.mroz</span>,</span>
<span>                          AIC<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                          ncores<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; R RNG seed set to 6681</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.061   0.005   1.748</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">m.mroz.sel.cv</span>, <span class="va">m.mroz.sel.cv.p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>In this small problem, the parallel computation is actually
<em>slower</em>, because there is an overhead cost to parallelization,
but we can see that it produces the same result as before.</p>
</div>
<div class="section level2">
<h2 id="computational-notes">Computational notes<a class="anchor" aria-label="anchor" href="#computational-notes"></a>
</h2>
<div class="section level3">
<h3 id="efficient-computations-for-linear-and-generalized-linear-models">Efficient computations for linear and generalized linear models<a class="anchor" aria-label="anchor" href="#efficient-computations-for-linear-and-generalized-linear-models"></a>
</h3>
<p>The most straightforward way to implement cross-validation in R for
statistical modeling functions that are written in the canonical manner
is to use <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> to refit the model with each fold
removed. This is the approach taken in the default method for
<code><a href="../reference/cv.html">cv()</a></code>, and it is appropriate if the cases are independently
sampled. Refitting the model in this manner for each fold is generally
feasible when the number of folds in modest, but can be prohibitively
costly for leave-one-out cross-validation when the number of cases is
large.</p>
<p>The <code>"lm"</code> and <code>"glm"</code> methods for
<code><a href="../reference/cv.html">cv()</a></code> take advantage of computational efficiencies by
avoiding refitting the model with each fold removed. Consider, in
particular, the weighted linear model <span class="math inline">\(\mathbf{y}_{n \times 1} = \mathbf{X}_{n \times
p}\boldsymbol{\beta}_{p \times 1} + \boldsymbol{\varepsilon}_{n \times
1}\)</span>, where <span class="math inline">\(\boldsymbol{\varepsilon}
\sim \mathbf{N}_n \left(\mathbf{0}, \sigma^2 \mathbf{W}^{-1}_{n \times
n}\right)\)</span>. Here, <span class="math inline">\(\mathbf{y}\)</span> is the response vector, <span class="math inline">\(\mathbf{X}\)</span> the model matrix, and <span class="math inline">\(\boldsymbol{\varepsilon}\)</span> the error
vector, each for <span class="math inline">\(n\)</span> cases, and <span class="math inline">\(\boldsymbol{\beta}\)</span> is the vector of <span class="math inline">\(p\)</span> population regression coefficients. The
errors are assumed to be multivariately normally distributed with 0
means and covariance matrix <span class="math inline">\(\sigma^2
\mathbf{W}^{-1}\)</span>, where <span class="math inline">\(\mathbf{W} =
\mathrm{diag}(w_i)\)</span> is a diagonal matrix of inverse-variance
weights. For the linear model with constant error variance, the weight
matrix is taken to be <span class="math inline">\(\mathbf{W} =
\mathbf{I}_n\)</span>, the order-<span class="math inline">\(n\)</span>
identity matrix.</p>
<p>The weighted-least-squares (WLS) estimator of <span class="math inline">\(\boldsymbol{\beta}\)</span> is <span class="citation">(see, e.g., Fox, 2016, sec. 12.2.2)</span> <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;This is a definitional formula, which assumes that the
model matrix &lt;span class="math inline"&gt;\(\mathbf{X}\)&lt;/span&gt; is of full
column rank, and which can be subject to numerical instability when
&lt;span class="math inline"&gt;\(\mathbf{X}\)&lt;/span&gt; is ill-conditioned.
&lt;code&gt;&lt;a href="https://rdrr.io/r/stats/lm.html" class="external-link"&gt;lm()&lt;/a&gt;&lt;/code&gt; uses the singular-value decomposition of the model
matrix to obtain computationally more stable results.&lt;/p&gt;'><sup>11</sup></a> <span class="math display">\[
\mathbf{b}_{\mathrm{WLS}} = \left( \mathbf{X}^T \mathbf{W} \mathbf{X}
\right)^{-1}
  \mathbf{X}^T \mathbf{W} \mathbf{y}
\]</span></p>
<p>Fitted values are then <span class="math inline">\(\widehat{\mathbf{y}} =
\mathbf{X}\mathbf{b}_{\mathrm{WLS}}\)</span>.</p>
<p>The LOO fitted value for the <span class="math inline">\(i\)</span>th
case can be efficiently computed by <span class="math inline">\(\widehat{y}_{-i} = y_i - e_i/(1 - h_i)\)</span>
where <span class="math inline">\(h_i = \mathbf{x}^T_i \left(
\mathbf{X}^T \mathbf{W} \mathbf{X} \right)^{-1} \mathbf{x}_i\)</span>
(the so-called “hatvalue”). Here, <span class="math inline">\(\mathbf{x}^T_i\)</span> is the <span class="math inline">\(i\)</span>th row of <span class="math inline">\(\mathbf{X}\)</span>, and <span class="math inline">\(\mathbf{x}_i\)</span> is the <span class="math inline">\(i\)</span>th row written as a column vector. This
approach can break down when one or more hatvalues are equal to 1, in
which case the formula for <span class="math inline">\(\widehat{y}_{-i}\)</span> requires division by
0.</p>
<p>To compute cross-validated fitted values when the folds contain more
than one case, we make use of the Woodbury matrix identify <span class="citation">("Woodbury matrix identity", 2023)</span>, <span class="math display">\[
\left(\mathbf{A}_{m \times m} + \mathbf{U}_{m \times k}
\mathbf{C}_{k \times k} \mathbf{V}_{k \times m} \right)^{-1} =
\mathbf{A}^{-1} - \mathbf{A}^{-1}\mathbf{U} \left(\mathbf{C}^{-1} +
\mathbf{VA}^{-1}\mathbf{U} \right)^{-1} \mathbf{VA}^{-1}
\]</span> where <span class="math inline">\(\mathbf{A}\)</span> is a
nonsingular order-<span class="math inline">\(n\)</span> matrix. We
apply this result by letting <span class="math display">\[\begin{align*}
    \mathbf{A} &amp;= \mathbf{X}^T \mathbf{W} \mathbf{X} \\
    \mathbf{U} &amp;= \mathbf{X}_\mathbf{j}^T \\
    \mathbf{V} &amp;= - \mathbf{X}_\mathbf{j} \\
    \mathbf{C} &amp;= \mathbf{W}_\mathbf{j} \\
\end{align*}\]</span> where the subscript <span class="math inline">\(\mathbf{j} = (i_{j1}, \ldots, i_{jm})^T\)</span>
represents the vector of indices for the cases in the <span class="math inline">\(j\)</span>th fold, <span class="math inline">\(j =
1, \ldots, k\)</span>. The negative sign in <span class="math inline">\(\mathbf{V} = - \mathbf{X}_\mathbf{j}\)</span>
reflects the <em>removal</em>, rather than addition, of the cases in
<span class="math inline">\(\mathbf{j}\)</span>.</p>
<p>Applying the Woodbury identity isn’t quite as fast as using the
hatvalues, but it is generally much faster than refitting the model. A
disadvantage of the Woodbury identity, however, is that it entails
explicit matrix inversion and thus may be numerically unstable. The
inverse of <span class="math inline">\(\mathbf{A} = \mathbf{X}^T
\mathbf{W} \mathbf{X}\)</span> is available directly in the
<code>"lm"</code> object, but the second term on the right-hand side of
the Woodbury identity requires a matrix inversion with each fold
deleted. (In contrast, the inverse of each <span class="math inline">\(\mathbf{C} = \mathbf{W}_\mathbf{j}\)</span> is
straightforward because <span class="math inline">\(\mathbf{W}\)</span>
is diagonal.)</p>
<p>The Woodbury identity also requires that the model matrix be of full
rank. We impose that restriction in our code by removing redundant
regressors from the model matrix for all of the cases, but that doesn’t
preclude rank deficiency from surfacing when a fold is removed. Rank
deficiency of <span class="math inline">\(\mathbf{X}\)</span> doesn’t
disqualify cross-validation because all we need are fitted values under
the estimated model.</p>
<p><code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> computes the maximum-likelihood estimates for a
generalized linear model by iterated weighted least squares <span class="citation">(see, e.g., Fox &amp; Weisberg, 2019, sec.
6.12)</span>. The last iteration is therefore just a WLS fit of the
“working response” on the model matrix using “working weights.” Both the
working weights and the working response at convergence are available
from the information in the object returned by <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>.</p>
<p>We then treat re-estimation of the model with a case or cases deleted
as a WLS problem, using the hatvalues or the Woodbury matrix identity.
The resulting fitted values for the deleted fold aren’t exact—that is,
except for the Gaussian family, the result isn’t identical to what we
would obtain by literally refitting the model—but in our (limited)
experience, the approximation is very good, especially for LOO CV, which
is when we would be most tempted to use it. Nevertheless, because these
results are approximate, the default for the <code>"glm"</code>
<code><a href="../reference/cv.html">cv()</a></code> method is to perform the exact computation, which
entails refitting the model with each fold omitted.</p>
</div>
<div class="section level3">
<h3 id="computation-of-the-bias-corrected-cv-criterion">Computation of the bias-corrected CV criterion<a class="anchor" aria-label="anchor" href="#computation-of-the-bias-corrected-cv-criterion"></a>
</h3>
<p>Let <span class="math inline">\(\mathrm{CV}(\mathbf{y},
\widehat{\mathbf{y}})\)</span> represent a cross-validation cost
criterion, such as mean-squared error, computed for all of the <span class="math inline">\(n\)</span> values of the response <span class="math inline">\(\mathbf{y}\)</span> based on fitted values <span class="math inline">\(\widehat{\mathbf{y}}\)</span> from the model fit
to all of the data. We divide the <span class="math inline">\(n\)</span>
cases into <span class="math inline">\(k\)</span> folds of approximately
<span class="math inline">\(n_j \approx n/k\)</span> cases each, where
<span class="math inline">\(n = \sum n_j\)</span>. As above, let <span class="math inline">\(\mathbf{j}\)</span> denote the indices of the
cases in the <span class="math inline">\(j\)</span>th fold.</p>
<p>Now define <span class="math inline">\(\mathrm{CV}_j =
\mathrm{CV}(\mathbf{y}, \widehat{\mathbf{y}}^{(j)})\)</span> and <span class="math inline">\(\mathrm{CV}_j^{(j)} =
\mathrm{CV}(\mathbf{y}_{\mathbf{j}},
\widehat{\mathbf{y}}^{(j)}_{\mathbf{j}})\)</span>. The superscript <span class="math inline">\((j)\)</span> on <span class="math inline">\(\widehat{\mathbf{y}}^{(j)}\)</span> and <span class="math inline">\(\widehat{\mathbf{y}}^{(j)}_{\mathbf{j}}\)</span>
represents fitted values computed from the model with fold <span class="math inline">\(j\)</span> omitted, respectively for all of the
cases (i.e., <span class="math inline">\(\mathrm{CV}_j\)</span>) and for
the cases only in the <span class="math inline">\(j\)</span>th fold
(<span class="math inline">\(\mathrm{CV}_j^{(j)}\)</span>).</p>
<p>Then the cross-validation criterion is the weighted average of the
<span class="math inline">\(\mathrm{CV}_j^{(j)}\)</span> <span class="math display">\[
\mathrm{CV} = \frac{1}{n} \sum_{j = 1}^{k} n_j \mathrm{CV}_j^{(j)}
\]</span> Following <span class="citation">Davison &amp; Hinkley (1997,
pp. 293–295)</span>, the bias-adjusted cross-validation criterion is
<span class="math display">\[
\mathrm{CV}_{\mathrm{adj}} = \mathrm{CV} + \mathrm{CV}(\mathbf{y},
\widehat{\mathbf{y}}) - \frac{1}{n} \sum_{j=1}^{k} n_j \mathrm{CV}_j
\]</span></p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-BatesEtAl:2015" class="csl-entry">
Bates, D., Mächler, M., Bolker, B., &amp; Walker, S. (2015). Fitting
linear mixed-effects models using <span class="nocase">lme4</span>.
<em>Journal of Statistical Software</em>, <em>67</em>(1), 1–48.
</div>
<div id="ref-BoxCox:1964" class="csl-entry">
Box, G. E. P., &amp; Cox, D. R. (1964). An analysis of transformations.
<em>Journal of the Royal Statistical Society, Series
<span>B</span></em>, <em>26</em>, 211–252.
</div>
<div id="ref-CantyRipley2022" class="csl-entry">
Canty, A., &amp; Ripley, B. D. (2022). <em>Boot: Bootstrap
<span>R</span> (<span>S</span>-plus) functions</em>.
</div>
<div id="ref-DavisonHinkley1997" class="csl-entry">
Davison, A. C., &amp; Hinkley, D. V. (1997). <em>Bootstrap methods and
their applications</em>. Cambridge: Cambridge University Press.
</div>
<div id="ref-Fox:2016" class="csl-entry">
Fox, J. (2016). <em>Applied regression analysis and generalized linear
models</em> (Second edition). Thousand Oaks <span>CA</span>: Sage.
</div>
<div id="ref-FoxWeisberg:2019" class="csl-entry">
Fox, J., &amp; Weisberg, S. (2019). <em>An <span>R</span> companion to
applied regression</em> (Third edition). Thousand Oaks <span>CA</span>:
Sage.
</div>
<div id="ref-Harrell:2015" class="csl-entry">
Harrell, F., Jr. (2015). <em>Regression modeling strategies</em> (Second
edition). New York: Springer.
</div>
<div id="ref-HastieTibshiraniFriedman:2009" class="csl-entry">
Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). <em>The elements
of statistical learning: Data mining, inference, and prediction</em>
(Second edition). New York: Springer. Retrieved from <a href="https://hastie.su.domains/ElemStatLearn/printings/ESLII_print12_toc.pdf" class="external-link">https://hastie.su.domains/ElemStatLearn/printings/ESLII_print12_toc.pdf</a>
</div>
<div id="ref-JamesEtAl:2021" class="csl-entry">
James, G., Witten, D., Hastie, T., &amp; Tibshirani, R. (2021). <em>An
introduction to statistical learning with applications in
<span>R</span></em> (Second edition). New York: Springer.
</div>
<div id="ref-Mersmann:2023" class="csl-entry">
Mersmann, O. (2023). <em>Microbenchmark: Accurate timing functions</em>.
Retrieved from <a href="https://CRAN.R-project.org/package=microbenchmark" class="external-link">https://CRAN.R-project.org/package=microbenchmark</a>
</div>
<div id="ref-PinheiroBates:2000" class="csl-entry">
Pinheiro, J. C., &amp; Bates, D. M. (2000). <em>Mixed-effects models in
<span>S</span> and <span>S-PLUS</span></em>. New York: Springer.
</div>
<div id="ref-RaudenbushBryk:2002" class="csl-entry">
Raudenbush, S. W., &amp; Bryk, A. S. (2002). <em>Hierarchical linear
models: Applications and data analysis methods</em> (Second edition).
Thousand Oaks <span>CA</span>: Sage.
</div>
<div id="ref-Sarkar:2008" class="csl-entry">
Sarkar, D. (2008). <em>Lattice: Multivariate data visualization with
<span>R</span></em>. New York: Springer. Retrieved from <a href="http://lmdvr.r-forge.r-project.org" class="external-link">http://lmdvr.r-forge.r-project.org</a>
</div>
<div id="ref-SarkarAndrews:2022" class="csl-entry">
Sarkar, D., &amp; Andrews, F. (2022). <em><span class="nocase">latticeExtra</span>: Extra graphical utilities based on
<span class="nocase">lattice</span></em>. Retrieved from <a href="https://CRAN.R-project.org/package=latticeExtra" class="external-link">https://CRAN.R-project.org/package=latticeExtra</a>
</div>
<div id="ref-VenablesRipley:2002" class="csl-entry">
Venables, W. N., &amp; Ripley, B. D. (2002). <em>Modern applied
statistics with <span>S</span></em> (Fourth edition). New York:
Springer.
</div>
<div id="ref-Weisberg:2014" class="csl-entry">
Weisberg, S. (2014). <em>Applied linear regression</em> (Second
edition). Hoboken <span>NJ</span>: Wiley.
</div>
<div id="ref-WickhamEtAl:2023" class="csl-entry">
Wickham, H., François, R., Henry, L., Müller, K., &amp; Vaughan, D.
(2023). <em>Dplyr: A grammar of data manipulation</em>. Retrieved from
<a href="https://CRAN.R-project.org/package=dplyr" class="external-link">https://CRAN.R-project.org/package=dplyr</a>
</div>
<div id="ref-Wikipedia-Woodbury:2023" class="csl-entry">
"Woodbury matrix identity". (2023). Woodbury matrix
identity—<span>W</span>ikipedia<span>,</span> the free encyclopedia.
Retrieved from <a href="https://en.wikipedia.org/wiki/Woodbury_matrix_identity" class="external-link">https://en.wikipedia.org/wiki/Woodbury_matrix_identity</a>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by John Fox, Georges Monette.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
